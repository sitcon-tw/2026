import{g as I,a as g,i as b,r as h,b as k}from"./local-storage.BX_TrTX5.js";import{g as E}from"./plan-helper.BokWQDVq.js";function L(e,a){a.preventDefault(),a.stopPropagation();const i=e.getAttribute("data-item-id")||"",t=e.getAttribute("data-item-deadline")||"";if(g(t))return;const d=e.closest(".card")||e.closest(".addon-card");if(d?.getAttribute("data-has-sub-items")==="true"||e.getAttribute("data-has-sub-items")==="true"){const r=`item-popup-${i}`;typeof window.popupCtrl=="function"&&window.popupCtrl(r,"open")}else{const r=e.getAttribute("data-item-title")||e.getAttribute("data-item-name")||"",s=e.getAttribute("data-item-image")||"",l=e.getAttribute("data-item-price")||"";if(b(i))h(i);else{const p=d?.querySelector(".deadline-tag")?.textContent||"",A=document.documentElement.lang||navigator.language||"zh-Hant",C=E(i,l,A);k({id:i,title:r,category:"all",image:s,deadline:p,price:C})}}}function o(){const e=I(),a=new Set(e.map(t=>t.id));document.querySelectorAll(".add-button").forEach(t=>{const d=t.getAttribute("data-item-id"),n=t.getAttribute("data-item-deadline")||"";if(g(n)?(t.setAttribute("disabled","true"),t.classList.add("disabled")):(t.removeAttribute("disabled"),t.classList.remove("disabled")),d){let s=a.has(d);if(!s){for(const l of a)if(typeof l=="string"&&l.startsWith(d+"-sub-")){s=!0;break}}s?t.classList.add("added"):t.classList.remove("added")}})}let c=!1,f=new Set;const u=new WeakSet;let m=!1;function v(){c||(document.addEventListener("click",e=>{const i=e.target.closest(".add-button");if(i instanceof HTMLElement){L(i,e);return}}),c=!0)}function y(e){f.add(e)}function w(){document.querySelectorAll(".card, .addon-card").forEach(a=>{if(u.has(a))return;const i=a.getAttribute("data-card-id")||a.getAttribute("data-item-id");i&&(a.style.cursor="pointer",a.addEventListener("click",t=>{t.target.closest(".add-button")||(t.stopPropagation(),f.forEach(n=>n(i,t)))}),u.add(a))})}function D(e={}){v(),e.onCardClick&&(y(e.onCardClick),w()),o(),m||(window.addEventListener("itemsChange",o),document.addEventListener("interested-items-changed",o),m=!0)}export{D as i,o as u};
