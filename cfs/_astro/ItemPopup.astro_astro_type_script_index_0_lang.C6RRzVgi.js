import{b as d,a as x,u as g,r as h}from"./local-storage.CNRxCPsY.js";const D="不限",L=/max\s+(\d+)/i;document.addEventListener("DOMContentLoaded",function(){function A(e){if(!e||e===D)return null;const t=e.match(L);return t?parseInt(t[1],10):null}function S(e){if(!e)return null;const t=parseInt(e,10);return isNaN(t)?A(e):t}function I(e,t){const r=A(e),i=parseInt(t,10);return isNaN(i)||r!==null&&r<i?r:i}function E(e){try{const t=document.querySelector(`.popup-content[data-item-id="${e}"]`);if(!t)return;const r=t.querySelector(".remaining");if(!r)return;const i=parseInt(r.getAttribute("data-initial-remaining")||"0",10),n=r.getAttribute("data-unit")||"",o=d(e)||0,a=Math.max(0,i-o),s=r.textContent?.split(" ")[0]||"";r.textContent=`${s} ${a} ${n}`}catch{}}function Q(e){try{const t=document.querySelector(`.popup-content[data-item-id="${e}"]`);if(!t)return;const r=t.querySelector(".remaining");if(!r)return;const i=r.getAttribute("data-unit")||"",n=t.querySelectorAll(`.sub-item-controls[data-item-id="${e}"]`);let o=0,a=0;n.forEach(u=>{const c=parseInt(u.getAttribute("data-initial-sub-item-remaining")||"0",10);o+=c;const b=u.getAttribute("data-sub-item-id")||"",m=d(b)||0;a+=m});const s=Math.max(0,o-a),l=r.textContent?.split(" ")[0]||"";r.textContent=`${l} ${s} ${i}`}catch{}}function y(e){try{const t=document.querySelector(`.quantity-controls[data-item-id="${e}"]`);if(!t)return;const r=t.querySelector(".quantity-display"),i=t.querySelector(".quantity-btn.minus"),n=t.querySelector(".quantity-btn.plus"),o=d(e)||0;r&&(r.textContent=o.toString());const a=t.getAttribute("data-quantity")||"",s=t.getAttribute("data-remaining")||"",l=I(a,s);l!==null&&n?n.disabled=o>=l:n&&(n.disabled=!1),i&&(i.disabled=o<=0),E(e)}catch{}}function f(e){try{const t=document.querySelector(`.sub-item-controls[data-sub-item-id="${e}"]`);if(!t)return;const r=t.querySelector(".sub-quantity-display"),i=t.querySelector(".sub-quantity-btn.minus"),n=t.querySelector(".sub-quantity-btn.plus"),o=d(e)||0;r&&(r.textContent=o.toString());const a=t.getAttribute("data-sub-item-remaining")||"",s=S(a);s!==null&&n?n.disabled=o>=s:n&&(n.disabled=!1),i&&(i.disabled=o<=0);const l=t.getAttribute("data-item-id");l&&Q(l)}catch{}}document.addEventListener("click",function(e){const t=e.target;if(t.closest(".sub-quantity-btn.plus")){e.preventDefault(),e.stopPropagation();const i=t.closest(".sub-quantity-btn.plus").closest(".sub-item-controls");if(!i)return;const n=i.getAttribute("data-sub-item-id");if(!n)return;const o=d(n)||0,a=o+1;if(o===0){const s=i.closest(".popup-content"),l=i.getAttribute("data-sub-item-name")||"",c=s?.querySelector(".item-image img")?.getAttribute("src")||"",m=s?.querySelector(".category")?.textContent||"",p=i.getAttribute("data-sub-item-remaining")||"",q=S(p);x({id:n,title:l,category:"all",image:c,deadline:m,quantity:1,maxQuantity:q})}else g(n,a);f(n)}if(t.closest(".sub-quantity-btn.minus")){e.preventDefault(),e.stopPropagation();const i=t.closest(".sub-quantity-btn.minus").closest(".sub-item-controls");if(!i)return;const n=i.getAttribute("data-sub-item-id");if(!n)return;const o=d(n)||0;if(o<=0)return;const a=o-1;a===0?h(n):g(n,a),f(n)}if(t.closest(".quantity-btn.plus")){e.preventDefault(),e.stopPropagation();const i=t.closest(".quantity-btn.plus").closest(".quantity-controls");if(!i)return;const n=i.getAttribute("data-item-id");if(!n)return;const o=d(n)||0,a=o+1;if(o===0){const s=i.closest(".popup-content"),l=s?.querySelector("h3")?.textContent||"",u=s?.querySelector("img"),c=u?.getAttribute("src")||u?.getAttribute("alt")||"",m=s?.querySelector(".category")?.textContent||"",p=i.getAttribute("data-quantity")||"",q=i.getAttribute("data-remaining")||"",C=I(p,q);x({id:n,title:l,category:"all",image:c,deadline:m,quantity:1,maxQuantity:C})}else g(n,a);y(n)}if(t.closest(".quantity-btn.minus")){e.preventDefault(),e.stopPropagation();const i=t.closest(".quantity-btn.minus").closest(".quantity-controls");if(!i)return;const n=i.getAttribute("data-item-id");if(!n)return;const o=d(n)||0;if(o<=0)return;const a=o-1;a===0?h(n):g(n,a),y(n)}}),window.addEventListener("itemsChange",function(){document.querySelectorAll(".quantity-controls").forEach(e=>{const t=e.getAttribute("data-item-id");t&&y(t)}),document.querySelectorAll(".sub-item-controls").forEach(e=>{const t=e.getAttribute("data-sub-item-id");t&&f(t)})}),document.querySelectorAll(".quantity-controls").forEach(e=>{const t=e.getAttribute("data-item-id");t&&y(t)}),document.querySelectorAll(".sub-item-controls").forEach(e=>{const t=e.getAttribute("data-sub-item-id");t&&f(t)});function v(){document.querySelectorAll(".image-carousel").forEach(e=>{try{let t=function(){if(n.forEach((u,c)=>{u.classList.toggle("active",c===s)}),l){const c=n[s].getAttribute("data-description")||"";l.textContent=c}},r=function(){s>0?s--:s=n.length-1,t()},i=function(){s<n.length-1?s++:s=0,t()};const n=e.querySelectorAll(".carousel-slide"),o=e.querySelector(".carousel-prev"),a=e.querySelector(".carousel-next");if(n.length===0)return;let s=0;const l=e.querySelector(".carousel-description");n.forEach(u=>{const c=u.querySelector("img");c&&c.addEventListener("error",()=>{})}),o&&o.addEventListener("click",u=>{u.preventDefault(),u.stopPropagation(),r()}),a&&a.addEventListener("click",u=>{u.preventDefault(),u.stopPropagation(),i()}),e.addEventListener("keydown",u=>{const c=u;c.key==="ArrowLeft"?(c.preventDefault(),r()):c.key==="ArrowRight"&&(c.preventDefault(),i())}),e.setAttribute("tabindex","0"),t()}catch{}})}v()});
