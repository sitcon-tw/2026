import{g as u,r as R,i as W}from"./local-storage.CNRxCPsY.js";document.addEventListener("DOMContentLoaded",function(){const c=document.getElementById("expandButton"),m=document.querySelector(".cards-container"),g=c?c.querySelector(".show-text"):null,v=c?c.querySelector(".hide-text"):null,y=c?c.querySelector(".arrow"):null;if(!c||!m||!g||!v||!y)return;let E=!1,I=!0;function h(){!I||E?(m.classList.remove("fade-active"),m.classList.add("fade-hidden"),g.style.display="none",v.style.display="inline",y.style.transform="rotate(180deg)"):(m.classList.remove("fade-hidden"),m.classList.add("fade-active"),g.style.display="inline",v.style.display="none",y.style.transform="rotate(0deg)")}c.addEventListener("click",function(){E=!E,h()});function H(t){const e=document.querySelector(".cards-grid");if(!e)return;const n=Array.from(e.querySelectorAll(".card"));let i=n.length;if(t==="all")n.sort((o,s)=>{const r=parseInt(o.getAttribute("data-order")||"0"),d=parseInt(s.getAttribute("data-order")||"0");return r-d});else{let o="data-order";t==="talent_recruitment"?o="data-talent-recruitment-order":t==="brand_exposure"?o="data-brand-exposure-order":t==="product_promotion"&&(o="data-product-promotion-order"),n.sort((s,r)=>{const d=parseInt(s.getAttribute(o)||"999999"),l=parseInt(r.getAttribute(o)||"999999");return d-l})}n.forEach(o=>{V(o,t)}),n.forEach(o=>e.appendChild(o)),L(i)}function N(){const t=window.innerWidth;return t<=768?2:t<=1024?4:6}function V(t,e){const n=t.querySelector(".description");if(!n)return;const i=t.getAttribute("data-descriptions");if(i)try{const o=JSON.parse(i),s=o[e]||o.all||"";n.textContent=s}catch{}}function L(t){const e=document.getElementById("expandButton");if(!e)return;const n=N();t>n?(I=!0,e.style.display="flex",h()):(I=!1,e.style.display="none",h())}const C=document.querySelectorAll(".tab");C.forEach(t=>{t.addEventListener("click",function(){const e=t;C.forEach(i=>i.classList.remove("active")),e.classList.add("active");const n=e.getAttribute("data-category")||"all";H(n)})});const M=document.querySelectorAll(".card").length;L(M),h(),window.addEventListener("resize",function(){const t=document.querySelectorAll(".card");L(t.length)});function S(){const t=u(),e=new Set(t.map(n=>n.id));document.querySelectorAll(".add-button").forEach(n=>{const i=n.getAttribute("data-item-id")||"";let o=e.has(i);if(!o){for(const s of e)if(s.startsWith(i+"-sub-")){o=!0;break}}o?n.classList.add("added"):n.classList.remove("added")})}function U(){document.querySelectorAll(".card").forEach(e=>{const n=e.getAttribute("data-card-id");n&&(e.style.cursor="pointer",e.addEventListener("click",function(i){if(i.target.closest(".add-button"))return;i.stopPropagation();const s=`item-popup-${n}`;popupCtrl(s,"open")}))})}function b(){document.querySelectorAll(".card").forEach(e=>{const n=e.getAttribute("data-card-id");n&&(W(n)?e.classList.add("highlighted"):e.classList.remove("highlighted"))})}document.addEventListener("click",function(t){const e=t.target;if(!(e instanceof Element))return;const n=e.closest(".add-button");if(!n)return;t.preventDefault(),t.stopPropagation();const o=`item-popup-${n.getAttribute("data-item-id")||""}`;popupCtrl(o,"open")});function q(){const t=u(),e=document.querySelector(".interest-count");e&&(t.length>0?e.textContent=t.length.toString():e.textContent="")}function T(){const t=u(),e=document.getElementById("interestItemsList");if(!e)return;if(t.length===0){e.innerHTML=`<div class="empty-state">${document.querySelector("[data-i18n-no-items]")?.textContent}</div>`;return}e.innerHTML="";const n=document.getElementById("removeIconTemplate");t.forEach(o=>{const s=document.createElement("div");s.className="interest-item",s.setAttribute("data-item-id",o.id);const r=document.createElement("div");r.className="item-content";const d=document.createElement("span");d.className="item-title",d.textContent=o.title;const l=document.createElement("button");if(l.className="remove-item",l.setAttribute("data-item-id",o.id),n){const O=n.content.cloneNode(!0);l.appendChild(O)}r.appendChild(d),r.appendChild(l),s.appendChild(r),e.appendChild(s)}),e.querySelectorAll(".remove-item").forEach(o=>{o.addEventListener("click",function(s){s.stopPropagation();const r=o.getAttribute("data-item-id")||"";R(r)})})}let x=u().length;window.addEventListener("itemsChange",function(t){q(),T(),b();let e=x;try{const n=t;n?.detail&&Array.isArray(n.detail.items)?e=n.detail.items.length:e=u().length}catch{e=u().length}e>x&&setTimeout(()=>P(),0),x=e});const B=document.getElementById("interestButton"),a=document.getElementById("interestPopover");function P(){a&&(T(),a.classList.add("active"))}function f(){a&&a.classList.remove("active")}B&&B.addEventListener("click",function(t){t.stopPropagation(),a?.classList.contains("active")?f():P()}),document.addEventListener("click",function(t){a?.classList.contains("active")&&!a.contains(t.target)&&!B?.contains(t.target)&&f()}),document.addEventListener("keydown",function(t){t.key==="Escape"&&f()}),document.addEventListener("click",function(t){if(t.target.closest(".view-plan-btn"))if(t.preventDefault(),p){const n=document.getElementById("form");n&&(n.scrollIntoView({behavior:"smooth"}),f())}else{const n=document.getElementById("plans");n&&(n.scrollIntoView({behavior:"smooth"}),f(),p=!0,D())}}),q(),S();const _=["items","plans","addons","form"];let k="",p=!1;const $=document.getElementById("viewPlanBtnText")?.textContent||"檢視方案詳情",z="聯絡我們";function D(){const t=document.getElementById("viewPlanBtnText");t&&(p?t.textContent=z:t.textContent=$)}function A(){const t=document.querySelectorAll(".interest-button");let e="";for(const n of _){const i=document.getElementById(n);if(i){const o=i.getBoundingClientRect(),s=o.height;if(Math.min(o.bottom,window.innerHeight)-Math.max(o.top,0)>s*.3){e=n;break}}}e!==k&&(k=e,e==="plans"&&!p&&(p=!0,D()),t.forEach(n=>{const i=n;e?i.style.display="flex":i.style.display="none"}))}let w;function F(){w&&cancelAnimationFrame(w),w=requestAnimationFrame(A)}document.addEventListener("scroll",F),window.addEventListener("resize",A),setTimeout(A,100),window.addEventListener("itemsChange",S),document.addEventListener("interested-items-changed",b),U(),b()});
