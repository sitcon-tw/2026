import{g as u,r as O,i as G}from"./local-storage.CNRxCPsY.js";document.addEventListener("DOMContentLoaded",function(){const a=document.getElementById("expandButton"),m=document.querySelector(".cards-container"),v=a?a.querySelector(".show-text"):null,y=a?a.querySelector(".hide-text"):null,E=a?a.querySelector(".arrow"):null;if(!a||!m||!v||!y||!E)return;let I=!1,B=!0;function g(){!B||I?(m.classList.remove("fade-active"),m.classList.add("fade-hidden"),v.style.display="none",y.style.display="inline",E.style.transform="rotate(180deg)"):(m.classList.remove("fade-hidden"),m.classList.add("fade-active"),v.style.display="inline",y.style.display="none",E.style.transform="rotate(0deg)")}a.addEventListener("click",function(){I=!I,g()});function V(t){const e=document.querySelector(".cards-grid");if(!e)return;const n=Array.from(e.querySelectorAll(".card"));let s=n.length;if(t==="all")n.sort((o,i)=>{const r=parseInt(o.getAttribute("data-order")||"0"),c=parseInt(i.getAttribute("data-order")||"0");return r-c});else{let o="data-order";t==="talent_recruitment"?o="data-talent-recruitment-order":t==="brand_exposure"?o="data-brand-exposure-order":t==="product_promotion"&&(o="data-product-promotion-order"),n.sort((i,r)=>{const c=parseInt(i.getAttribute(o)||"999999"),d=parseInt(r.getAttribute(o)||"999999");return c-d})}n.forEach(o=>{U(o,t)}),n.forEach(o=>e.appendChild(o)),b(s)}function M(){const t=window.innerWidth;return t<=768?2:t<=1024?4:6}function U(t,e){const n=t.querySelector(".description");if(!n)return;const s=t.getAttribute("data-descriptions");if(s)try{const o=JSON.parse(s),i=o[e]||o.all||"";n.textContent=i}catch{}}function b(t){const e=document.getElementById("expandButton");if(!e)return;const n=M();t>n?(B=!0,e.style.display="flex",g()):(B=!1,e.style.display="none",g())}const A=document.querySelectorAll(".tab");A.forEach(t=>{t.addEventListener("click",function(){const e=t;A.forEach(s=>s.classList.remove("active")),e.classList.add("active");const n=e.getAttribute("data-category")||"all";V(n)})});const W=document.querySelectorAll(".card").length;b(W),g(),window.addEventListener("resize",function(){const t=document.querySelectorAll(".card");b(t.length)});function q(){const t=u(),e=new Set(t.map(n=>n.id));document.querySelectorAll(".add-button").forEach(n=>{const s=n.getAttribute("data-item-id")||"";let o=e.has(s);if(!o){for(const i of e)if(i.startsWith(s+"-sub-")){o=!0;break}}o?n.classList.add("added"):n.classList.remove("added")})}function _(){document.querySelectorAll(".card").forEach(e=>{const n=e.getAttribute("data-card-id");n&&(e.style.cursor="pointer",e.addEventListener("click",function(s){if(s.target.closest(".add-button"))return;s.stopPropagation();const i=`item-popup-${n}`;popupCtrl(i,"open")}))})}function L(){document.querySelectorAll(".card").forEach(e=>{const n=e.getAttribute("data-card-id");n&&(G(n)?e.classList.add("highlighted"):e.classList.remove("highlighted"))})}document.addEventListener("click",function(t){const e=t.target;if(!(e instanceof Element))return;const n=e.closest(".add-button");if(!n)return;t.preventDefault(),t.stopPropagation();const o=`item-popup-${n.getAttribute("data-item-id")||""}`;popupCtrl(o,"open")});function T(){const t=u(),e=document.querySelector(".interest-count");e&&(t.length>0?e.textContent=t.length.toString():e.textContent="")}function P(){const t=u(),e=document.getElementById("interestItemsList");if(!e)return;if(t.length===0){e.innerHTML=`<div class="empty-state">${document.querySelector("[data-i18n-no-items]")?.textContent}</div>`;return}e.innerHTML="";const n=document.getElementById("removeIconTemplate");t.forEach(o=>{const i=document.createElement("div");i.className="interest-item",i.setAttribute("data-item-id",o.id);const r=document.createElement("div");r.className="item-content";const c=document.createElement("span");c.className="item-title",c.textContent=o.title;const d=document.createElement("button");if(d.className="remove-item",d.setAttribute("data-item-id",o.id),n){const R=n.content.cloneNode(!0);d.appendChild(R)}r.appendChild(c),r.appendChild(d),i.appendChild(r),e.appendChild(i)}),e.querySelectorAll(".remove-item").forEach(o=>{o.addEventListener("click",function(i){i.stopPropagation();const r=o.getAttribute("data-item-id")||"";O(r)})})}let w=u().length;window.addEventListener("itemsChange",function(t){T(),P(),L();let e=w;try{const n=t;n?.detail&&Array.isArray(n.detail.items)?e=n.detail.items.length:e=u().length}catch{e=u().length}e>w&&setTimeout(()=>k(),0),w=e});const x=document.getElementById("interestButton"),l=document.getElementById("interestPopover");function k(){l&&(P(),l.classList.add("active"))}function f(){l&&l.classList.remove("active")}x&&x.addEventListener("click",function(t){t.stopPropagation(),l?.classList.contains("active")?f():k()}),document.addEventListener("click",function(t){l?.classList.contains("active")&&!l.contains(t.target)&&!x?.contains(t.target)&&f()}),document.addEventListener("keydown",function(t){t.key==="Escape"&&f()}),document.addEventListener("click",function(t){if(t.target.closest(".view-plan-btn"))if(t.preventDefault(),p){const n=document.getElementById("form");n&&(n.scrollIntoView({behavior:"smooth"}),f())}else{const n=document.getElementById("plans");n&&(n.scrollIntoView({behavior:"smooth"}),f(),p=!0,N())}}),T(),q();const h=["items","plans","addons","form"];let D="",p=!1,H=!1;const $=document.getElementById("viewPlanBtnText")?.textContent||"檢視方案詳情",z="聯絡我們";function N(){const t=document.getElementById("viewPlanBtnText");t&&(p?t.textContent=z:t.textContent=$)}function C(){const t=document.querySelectorAll(".interest-button");let e=!1,n="";for(const i of h){const r=document.getElementById(i);if(r){const c=r.getBoundingClientRect(),d=c.height;if(Math.min(c.bottom,window.innerHeight)-Math.max(c.top,0)>d*.3){n=i;break}}}n&&n!==D&&(D=n,n==="plans"&&!p&&(p=!0,N()));const s=document.getElementById(h[0]),o=document.getElementById(h[h.length-1]);if(s&&o){const i=s.getBoundingClientRect(),r=o.getBoundingClientRect(),c=window.innerHeight;e=i.top<c&&r.bottom>0}e!==H&&(H=e,t.forEach(i=>{const r=i;r.style.display=e?"flex":"none"}))}let S;function F(){S&&cancelAnimationFrame(S),S=requestAnimationFrame(C)}document.addEventListener("scroll",F),window.addEventListener("resize",C),setTimeout(C,100),window.addEventListener("itemsChange",q),document.addEventListener("interested-items-changed",L),_(),L()});
