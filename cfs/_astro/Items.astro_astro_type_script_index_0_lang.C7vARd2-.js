import{i as M,r as O,a as Q,g as u}from"./local-storage.CNRxCPsY.js";document.addEventListener("DOMContentLoaded",function(){const d=document.getElementById("expandButton"),m=document.querySelector(".cards-container"),v=d?d.querySelector(".show-text"):null,E=d?d.querySelector(".hide-text"):null,I=d?d.querySelector(".arrow"):null;if(!d||!m||!v||!E||!I)return;let b=!1,B=!0;function g(){if(!B||b)m.classList.remove("fade-active"),m.classList.add("fade-hidden"),v.style.display="none",E.style.display="inline",I.style.transform="rotate(180deg)";else{m.classList.remove("fade-hidden"),m.classList.add("fade-active"),v.style.display="inline",E.style.display="none",I.style.transform="rotate(0deg)";const e=document.getElementById("items");if(e){const s=e.getBoundingClientRect().top+window.pageYOffset+-20;window.scrollTo({top:s,behavior:"smooth"})}}}d.addEventListener("click",function(){b=!b,g()});function w(t){return t.filter(e=>!e.classList.contains("package-exclusive-item"))}function U(t){const e=document.querySelector(".cards-grid");if(!e)return;const n=Array.from(e.querySelectorAll(".card"));let s=w(n).length;if(t==="all")n.sort((o,i)=>{const r=parseInt(o.getAttribute("data-order")||"0"),a=parseInt(i.getAttribute("data-order")||"0");return r-a});else{let o="data-order";t==="talent_recruitment"?o="data-talent-recruitment-order":t==="brand_exposure"?o="data-brand-exposure-order":t==="product_promotion"&&(o="data-product-promotion-order"),n.sort((i,r)=>{const a=parseInt(i.getAttribute(o)||"999999"),c=parseInt(r.getAttribute(o)||"999999");return a-c})}n.forEach(o=>{_(o,t)}),n.forEach(o=>e.appendChild(o)),A(s)}function W(){const t=window.innerWidth;return t<=768?2:t<=1024?4:6}function _(t,e){const n=t.querySelector(".description");if(!n)return;const s=t.getAttribute("data-descriptions");if(s)try{const o=JSON.parse(s),i=o[e]||o.all||"";n.textContent=i}catch{}}function A(t){const e=document.getElementById("expandButton");if(!e)return;const n=W();t>n?(B=!0,e.style.display="flex",g()):(B=!1,e.style.display="none",g())}const T=document.querySelectorAll(".tab");T.forEach(t=>{t.addEventListener("click",function(){const e=t;T.forEach(s=>s.classList.remove("active")),e.classList.add("active");const n=e.getAttribute("data-category")||"all";U(n)})});const $=w(Array.from(document.querySelectorAll(".card"))).length;A($),g(),window.addEventListener("resize",function(){const t=w(Array.from(document.querySelectorAll(".card")));A(t.length)});function P(){const t=u(),e=new Set(t.map(n=>n.id));document.querySelectorAll(".add-button").forEach(n=>{const s=n.getAttribute("data-item-id")||"";let o=e.has(s);if(!o){for(const i of e)if(i.startsWith(s+"-sub-")){o=!0;break}}o?n.classList.add("added"):n.classList.remove("added")})}function z(){document.querySelectorAll(".card").forEach(e=>{const n=e.getAttribute("data-card-id");n&&(e.style.cursor="pointer",e.addEventListener("click",function(s){if(s.target.closest(".add-button"))return;s.stopPropagation();const i=`item-popup-${n}`;popupCtrl(i,"open")}))})}function S(){document.querySelectorAll(".card").forEach(e=>{const n=e.getAttribute("data-card-id");n&&(M(n)?e.classList.add("highlighted"):e.classList.remove("highlighted"))})}document.addEventListener("click",function(t){const e=t.target;if(!(e instanceof Element))return;const n=e.closest(".add-button");if(!n)return;t.preventDefault(),t.stopPropagation();const s=n.getAttribute("data-item-id")||"",o=n.closest(".card");if(o?.getAttribute("data-has-sub-items")==="true"){const r=`item-popup-${s}`;popupCtrl(r,"open")}else{const r=n.getAttribute("data-item-title")||"",a=n.getAttribute("data-item-image")||"";if(M(s))O(s);else{const y=o?.querySelector(".deadline-tag")?.textContent||"";Q({id:s,title:r,category:"all",image:a,deadline:y,quantity:1,maxQuantity:1})}}});function k(){const t=u(),e=document.querySelector(".interest-count");e&&(t.length>0?e.textContent=t.length.toString():e.textContent="")}function D(){const t=u(),e=document.getElementById("interestItemsList");if(!e)return;if(t.length===0){e.innerHTML=`<div class="empty-state">${document.querySelector("[data-i18n-no-items]")?.textContent}</div>`;return}e.innerHTML="";const n=document.getElementById("removeIconTemplate");t.forEach(o=>{const i=document.createElement("div");i.className="interest-item",i.setAttribute("data-item-id",o.id);const r=document.createElement("div");r.className="item-content";const a=document.createElement("span");a.className="item-title",a.textContent=o.title;const c=document.createElement("button");if(c.className="remove-item",c.setAttribute("data-item-id",o.id),n){const y=n.content.cloneNode(!0);c.appendChild(y)}r.appendChild(a),r.appendChild(c),i.appendChild(r),e.appendChild(i)}),e.querySelectorAll(".remove-item").forEach(o=>{o.addEventListener("click",function(i){i.stopPropagation();const r=o.getAttribute("data-item-id")||"";O(r)})})}let x=u().length;window.addEventListener("itemsChange",function(t){k(),D(),S();let e=x;try{const n=t;n?.detail&&Array.isArray(n.detail.items)?e=n.detail.items.length:e=u().length}catch{e=u().length}e>x&&setTimeout(()=>H(),0),x=e});const C=document.getElementById("interestButton"),l=document.getElementById("interestPopover");function H(){l&&(D(),l.classList.add("active"))}function f(){l&&l.classList.remove("active")}C&&C.addEventListener("click",function(t){t.stopPropagation(),l?.classList.contains("active")?f():H()}),document.addEventListener("click",function(t){l?.classList.contains("active")&&!l.contains(t.target)&&!C?.contains(t.target)&&f()}),document.addEventListener("keydown",function(t){t.key==="Escape"&&f()}),document.addEventListener("click",function(t){if(t.target.closest(".view-plan-btn"))if(t.preventDefault(),p){const n=document.getElementById("form");n&&(n.scrollIntoView({behavior:"smooth"}),f())}else{const n=document.getElementById("plans");n&&(n.scrollIntoView({behavior:"smooth"}),f(),p=!0,N())}}),k(),P();const h=["items","plans","addons","form"];let R="",p=!1,V=!1;const F=document.getElementById("viewPlanBtnText")?.textContent||"檢視方案詳情",G="聯絡我們";function N(){const t=document.getElementById("viewPlanBtnText");t&&(p?t.textContent=G:t.textContent=F)}function L(){const t=document.querySelectorAll(".interest-button");let e=!1,n="";for(const i of h){const r=document.getElementById(i);if(r){const a=r.getBoundingClientRect(),c=a.height;if(Math.min(a.bottom,window.innerHeight)-Math.max(a.top,0)>c*.3){n=i;break}}}n&&n!==R&&(R=n,n==="plans"&&!p&&(p=!0,N()));const s=document.getElementById(h[0]),o=document.getElementById(h[h.length-1]);if(s&&o){const i=s.getBoundingClientRect(),r=o.getBoundingClientRect(),a=window.innerHeight;e=i.top<a&&r.bottom>0}e!==V&&(V=e,t.forEach(i=>{const r=i;r.style.display=e?"flex":"none"}))}let q;function J(){q&&cancelAnimationFrame(q),q=requestAnimationFrame(L)}document.addEventListener("scroll",J),window.addEventListener("resize",L),setTimeout(L,100),window.addEventListener("itemsChange",P),document.addEventListener("interested-items-changed",S),z(),S()});
