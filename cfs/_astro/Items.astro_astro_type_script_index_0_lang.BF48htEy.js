import{i as M,r as O,a as j,g as m}from"./local-storage.CNRxCPsY.js";import{g as K}from"./plan-helper.3qqJhLrq.js";document.addEventListener("DOMContentLoaded",function(){const d=document.getElementById("expandButton"),f=document.querySelector(".cards-container"),y=d?d.querySelector(".show-text"):null,v=d?d.querySelector(".hide-text"):null,E=d?d.querySelector(".arrow"):null;if(!d||!f||!y||!v||!E)return;let I=!1,b=!0;function g(){if(!b||I)f.classList.remove("fade-active"),f.classList.add("fade-hidden"),y.style.display="none",v.style.display="inline",E.style.transform="rotate(180deg)";else{f.classList.remove("fade-hidden"),f.classList.add("fade-active"),y.style.display="inline",v.style.display="none",E.style.transform="rotate(0deg)";const t=document.getElementById("items");if(t){const i=t.getBoundingClientRect().top+window.pageYOffset+-20;window.scrollTo({top:i,behavior:"smooth"})}}}d.addEventListener("click",function(){I=!I,g()});function w(e){return e.filter(t=>!t.classList.contains("package-exclusive-item"))}function U(e){const t=document.querySelector(".cards-grid");if(!t)return;const n=Array.from(t.querySelectorAll(".card"));let i=w(n).length;if(e==="all")n.sort((o,s)=>{const r=parseInt(o.getAttribute("data-order")||"0"),a=parseInt(s.getAttribute("data-order")||"0");return r-a});else{let o="data-order";e==="talent_recruitment"?o="data-talent-recruitment-order":e==="brand_exposure"?o="data-brand-exposure-order":e==="product_promotion"&&(o="data-product-promotion-order"),n.sort((s,r)=>{const a=parseInt(s.getAttribute(o)||"999999"),c=parseInt(r.getAttribute(o)||"999999");return a-c})}n.forEach(o=>{W(o,e)}),n.forEach(o=>t.appendChild(o)),B(i)}function _(){const e=window.innerWidth;return e<=768?2:e<=1024?4:6}function W(e,t){const n=e.querySelector(".description");if(!n)return;const i=e.getAttribute("data-descriptions");if(i)try{const o=JSON.parse(i),s=o[t]||o.all||"";n.textContent=s}catch{}}function B(e){const t=document.getElementById("expandButton");if(!t)return;const n=_();e>n?(b=!0,t.style.display="flex",g()):(b=!1,t.style.display="none",g())}const T=document.querySelectorAll(".tab");T.forEach(e=>{e.addEventListener("click",function(){const t=e;T.forEach(i=>i.classList.remove("active")),t.classList.add("active");const n=t.getAttribute("data-category")||"all";U(n)})});const $=w(Array.from(document.querySelectorAll(".card"))).length;B($),g(),window.addEventListener("resize",function(){const e=w(Array.from(document.querySelectorAll(".card")));B(e.length)});function P(){const e=m(),t=new Set(e.map(n=>n.id));document.querySelectorAll(".add-button").forEach(n=>{const i=n.getAttribute("data-item-id")||"";let o=t.has(i);if(!o){for(const s of t)if(s.startsWith(i+"-sub-")){o=!0;break}}o?n.classList.add("added"):n.classList.remove("added")})}function z(){document.querySelectorAll(".card").forEach(t=>{const n=t.getAttribute("data-card-id");n&&(t.style.cursor="pointer",t.addEventListener("click",function(i){if(i.target.closest(".add-button"))return;i.stopPropagation();const s=`item-popup-${n}`;popupCtrl(s,"open")}))})}function A(){document.querySelectorAll(".card").forEach(t=>{const n=t.getAttribute("data-card-id");n&&(M(n)?t.classList.add("highlighted"):t.classList.remove("highlighted"))})}document.addEventListener("click",function(e){const t=e.target;if(!(t instanceof Element))return;const n=t.closest(".add-button");if(!n)return;e.preventDefault(),e.stopPropagation();const i=n.getAttribute("data-item-id")||"",o=n.closest(".card");if(o?.getAttribute("data-has-sub-items")==="true"){const r=`item-popup-${i}`;popupCtrl(r,"open")}else{const r=n.getAttribute("data-item-title")||"",a=n.getAttribute("data-item-image")||"",c=n.getAttribute("data-item-price")||"";if(M(i))O(i);else{const Q=o?.querySelector(".deadline-tag")?.textContent||"",Y=K(i,c);j({id:i,title:r,category:"all",image:a,deadline:Q,quantity:1,maxQuantity:1,price:Y})}}});function k(){const e=m(),t=document.querySelector(".interest-count");t&&(e.length>0?t.textContent=e.length.toString():t.textContent="")}function D(){const e=m(),t=document.getElementById("interestItemsList");if(!t)return;if(e.length===0){t.innerHTML=`<div class="empty-state">${document.querySelector("[data-i18n-no-items]")?.textContent}</div>`;return}t.innerHTML="";const n=document.getElementById("removeIconTemplate");e.forEach(o=>{const s=document.createElement("div");s.className="interest-item",s.setAttribute("data-item-id",o.id);const r=document.createElement("div");r.className="item-content";const a=document.createElement("span");a.className="item-title",a.textContent=o.title;const c=document.createElement("button");if(c.className="remove-item",c.setAttribute("data-item-id",o.id),n){const q=n.content.cloneNode(!0);c.appendChild(q)}r.appendChild(a),r.appendChild(c),s.appendChild(r),t.appendChild(s)}),t.querySelectorAll(".remove-item").forEach(o=>{o.addEventListener("click",function(s){s.stopPropagation();const r=o.getAttribute("data-item-id")||"";O(r)})})}let S=m().length;window.addEventListener("itemsChange",function(e){k(),D(),A();let t=S;try{const n=e;n?.detail&&Array.isArray(n.detail.items)?t=n.detail.items.length:t=m().length}catch{t=m().length}t>S&&setTimeout(()=>H(),0),S=t});const x=document.getElementById("interestButton"),l=document.getElementById("interestPopover");function H(){l&&(D(),l.classList.add("active"))}function u(){l&&l.classList.remove("active")}x&&x.addEventListener("click",function(e){e.stopPropagation(),l?.classList.contains("active")?u():H()}),document.addEventListener("click",function(e){l?.classList.contains("active")&&!l.contains(e.target)&&!x?.contains(e.target)&&u()}),document.addEventListener("keydown",function(e){e.key==="Escape"&&u()}),document.addEventListener("click",function(e){const t=e.target;if(t.closest(".download-quote-btn")){e.preventDefault();const n=window.location.pathname+"quotation/";window.open(n,"_blank"),u()}if(t.closest(".view-plan-btn"))if(e.preventDefault(),p){const n=document.getElementById("form");n&&(n.scrollIntoView({behavior:"smooth"}),u())}else{const n=document.getElementById("plans");n&&(n.scrollIntoView({behavior:"smooth"}),u(),p=!0,N())}}),k(),P();const h=["items","plans","addons","form"];let R="",p=!1,V=!1;const F=document.getElementById("viewPlanBtnText")?.textContent||"檢視方案詳情",G="聯絡我們";function N(){const e=document.getElementById("viewPlanBtnText");e&&(p?e.textContent=G:e.textContent=F)}function C(){const e=document.querySelectorAll(".interest-button");let t=!1,n="";for(const s of h){const r=document.getElementById(s);if(r){const a=r.getBoundingClientRect(),c=a.height;if(Math.min(a.bottom,window.innerHeight)-Math.max(a.top,0)>c*.3){n=s;break}}}n&&n!==R&&(R=n,n==="plans"&&!p&&(p=!0,N()));const i=document.getElementById(h[0]),o=document.getElementById(h[h.length-1]);if(i&&o){const s=i.getBoundingClientRect(),r=o.getBoundingClientRect(),a=window.innerHeight;t=s.top<a&&r.bottom>0}t!==V&&(V=t,e.forEach(s=>{const r=s;r.style.display=t?"flex":"none"}))}let L;function J(){L&&cancelAnimationFrame(L),L=requestAnimationFrame(C)}document.addEventListener("scroll",J),window.addEventListener("resize",C),setTimeout(C,100),window.addEventListener("itemsChange",P),document.addEventListener("interested-items-changed",A),z(),A()});
