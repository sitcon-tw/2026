import{g as h,a as f,i as k,r as L,b as v}from"./local-storage.BX_TrTX5.js";import{g as E}from"./plan-helper.GKC8TKHI.js";function S(t,a){a.preventDefault(),a.stopPropagation();const i=t.getAttribute("data-item-id")||"",e=t.getAttribute("data-item-deadline")||"",d=t.closest(".card")||t.closest(".addon-card");if(d?.getAttribute("data-is-sold-out")==="true"||f(e))return;if(d?.getAttribute("data-has-sub-items")==="true"||t.getAttribute("data-has-sub-items")==="true"){const s=`item-popup-${i}`;typeof window.popupCtrl=="function"&&window.popupCtrl(s,"open")}else{const s=t.getAttribute("data-item-title")||t.getAttribute("data-item-name")||"",c=t.getAttribute("data-item-image")||"",r=t.getAttribute("data-item-price")||"";if(k(i))L(i);else{const C=d?.querySelector(".deadline-tag")?.textContent||"",I=document.documentElement.lang||navigator.language||"zh-Hant",b=E(i,r,I);v({id:i,title:s,category:"all",image:c,deadline:C,price:b})}}}function l(){const t=h(),a=new Set(t.map(e=>e.id));document.querySelectorAll(".add-button").forEach(e=>{const d=e.getAttribute("data-item-id"),n=e.getAttribute("data-item-deadline")||"",s=e.closest(".card, .addon-card")?.getAttribute("data-is-sold-out")==="true";if(f(n)||s?(e.setAttribute("disabled","true"),e.classList.add("disabled"),e.classList.remove("added")):(e.removeAttribute("disabled"),e.classList.remove("disabled")),d){let r=a.has(d);if(!r){for(const o of a)if(typeof o=="string"&&o.startsWith(d+"-sub-")){r=!0;break}}r?e.classList.add("added"):e.classList.remove("added")}})}let u=!1,p=new Set;const m=new WeakSet;let g=!1;function y(){u||(document.addEventListener("click",t=>{const i=t.target.closest(".add-button");if(i instanceof HTMLElement){S(i,t);return}}),u=!0)}function w(t){p.add(t)}function H(){document.querySelectorAll(".card, .addon-card").forEach(a=>{if(m.has(a))return;const i=a.getAttribute("data-card-id")||a.getAttribute("data-item-id");i&&(a.style.cursor="pointer",a.addEventListener("click",e=>{e.target.closest(".add-button")||(e.stopPropagation(),p.forEach(n=>n(i,e)))}),m.add(a))})}function x(t={}){y(),t.onCardClick&&(w(t.onCardClick),H()),l(),g||(window.addEventListener("itemsChange",l),document.addEventListener("interested-items-changed",l),g=!0)}export{x as i,l as u};
