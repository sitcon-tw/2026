import{g as m,i as D,r as H,a as $}from"./local-storage.yZB-lsyX.js";import{g as z}from"./plan-helper.3qqJhLrq.js";const d=document.getElementById("expandButton"),f=document.querySelector(".cards-container"),C=d?d.querySelector(".show-text"):null,L=d?d.querySelector(".hide-text"):null,q=d?d.querySelector(".arrow"):null;let I=!1,b=!0,R=!0;const h=()=>{if(!b||I)f.classList.remove("fade-active"),f.classList.add("fade-hidden"),C.style.display="none",L.style.display="inline",q.style.transform="rotate(180deg)";else if(f.classList.remove("fade-hidden"),f.classList.add("fade-active"),C.style.display="inline",L.style.display="none",q.style.transform="rotate(0deg)",!R){const t=document.getElementById("items");if(t){const s=t.getBoundingClientRect().top+window.pageYOffset+-20;window.scrollTo({top:s,behavior:"smooth"})}}};d&&d.addEventListener("click",()=>{I=!I,R=!1,h()});const B=e=>e.filter(t=>!t.classList.contains("package-exclusive-item")),F=e=>{const t=document.querySelector(".cards-grid");if(!t)return;const n=Array.from(t.querySelectorAll(".card"));let s=B(n).length;if(e==="all")n.sort((o,i)=>{const r=parseInt(o.getAttribute("data-order")||"0"),a=parseInt(i.getAttribute("data-order")||"0");return r-a});else{let o="data-order";e==="talent_recruitment"?o="data-talent-recruitment-order":e==="brand_exposure"?o="data-brand-exposure-order":e==="product_promotion"&&(o="data-product-promotion-order"),n.sort((i,r)=>{const a=parseInt(i.getAttribute(o)||"999999"),c=parseInt(r.getAttribute(o)||"999999");return a-c})}n.forEach(o=>{J(o,e)}),n.forEach(o=>t.appendChild(o)),A(s)},G=()=>{const e=window.innerWidth;return e<=768?2:e<=1024?4:6},J=(e,t)=>{const n=e.querySelector(".description");if(!n)return;const s=e.getAttribute("data-descriptions");if(s)try{const o=JSON.parse(s),i=o[t]||o.all||"";n.textContent=i}catch{}},A=e=>{const t=document.getElementById("expandButton");if(!t)return;const n=G();e>n?(b=!0,t.style.display="flex",h()):(b=!1,t.style.display="none",h())},T=document.querySelectorAll(".tab");T.forEach(e=>{e.addEventListener("click",()=>{const t=e;T.forEach(s=>s.classList.remove("active")),t.classList.add("active");const n=t.getAttribute("data-category")||"all";F(n)})});const Y=B(Array.from(document.querySelectorAll(".card"))).length;A(Y);h();window.addEventListener("resize",()=>{const e=B(Array.from(document.querySelectorAll(".card")));A(e.length)});const V=()=>{const e=m(),t=new Set(e.map(n=>n.id));document.querySelectorAll(".add-button").forEach(n=>{const s=n.getAttribute("data-item-id")||"";let o=t.has(s);if(!o){for(const i of t)if(i.startsWith(s+"-sub-")){o=!0;break}}o?n.classList.add("added"):n.classList.remove("added")})},j=()=>{document.querySelectorAll(".card").forEach(t=>{const n=t.getAttribute("data-card-id");n&&(t.style.cursor="pointer",t.addEventListener("click",s=>{if(s.target.closest(".add-button"))return;s.stopPropagation();const i=`item-popup-${n}`;popupCtrl(i,"open")}))})},S=()=>{document.querySelectorAll(".card").forEach(t=>{const n=t.getAttribute("data-card-id");n&&(D(n)?t.classList.add("highlighted"):t.classList.remove("highlighted"))})},N=()=>{const e=m(),t=document.querySelector(".interest-count");t&&(e.length>0?t.textContent=e.length.toString():t.textContent="")},M=()=>{const e=m(),t=document.getElementById("interestItemsList");if(!t)return;if(e.length===0){t.innerHTML=`<div class="empty-state">${document.querySelector("[data-i18n-no-items]")?.textContent}</div>`;return}t.innerHTML="";const n=document.getElementById("removeIconTemplate");e.forEach(o=>{const i=document.createElement("div");i.className="interest-item",i.setAttribute("data-item-id",o.id);const r=document.createElement("div");r.className="item-content";const a=document.createElement("span");a.className="item-title",a.textContent=o.title;const c=document.createElement("button");if(c.className="remove-item",c.setAttribute("data-item-id",o.id),n){const y=n.content.cloneNode(!0);c.appendChild(y)}r.appendChild(a),r.appendChild(c),i.appendChild(r),t.appendChild(i)}),t.querySelectorAll(".remove-item").forEach(o=>{o.addEventListener("click",i=>{i.stopPropagation();const r=o.getAttribute("data-item-id")||"";H(r)})})};let v=m().length;window.addEventListener("itemsChange",e=>{N(),M(),S();let t=v;try{const n=e;n?.detail&&Array.isArray(n.detail.items)?t=n.detail.items.length:t=m().length}catch{t=m().length}t>v&&setTimeout(()=>O(),0),v=t});const w=document.getElementById("interestButton"),l=document.getElementById("interestPopover"),O=()=>{l&&(M(),l.classList.add("active"))},u=()=>{l&&l.classList.remove("active")};w&&w.addEventListener("click",e=>{e.stopPropagation(),l?.classList.contains("active")?u():O()});document.addEventListener("click",e=>{const t=e.target;if(!(t instanceof Element))return;const n=t.closest(".add-button");if(n){e.preventDefault(),e.stopPropagation();const s=n.getAttribute("data-item-id")||"",o=n.closest(".card");if(o?.getAttribute("data-has-sub-items")==="true"){const r=`item-popup-${s}`;popupCtrl(r,"open")}else{const r=n.getAttribute("data-item-title")||"",a=n.getAttribute("data-item-image")||"",c=n.getAttribute("data-item-price")||"";if(D(s))H(s);else{const _=o?.querySelector(".deadline-tag")?.textContent||"",W=z(s,c);$({id:s,title:r,category:"all",image:a,deadline:_,price:W})}}return}if(l?.classList.contains("active")&&!l.contains(e.target)&&!w?.contains(e.target)){u();return}if(t.closest(".download-quote-btn")){e.preventDefault();const s=window.location.origin+"/2026/cfs/quotation";window.open(s,"_blank"),u();return}if(t.closest(".view-plan-btn")){if(e.preventDefault(),p){const s=document.getElementById("form");s&&(s.scrollIntoView({behavior:"smooth"}),u())}else{const s=document.getElementById("plans");s&&(s.scrollIntoView({behavior:"smooth"}),u(),p=!0,U())}return}});document.addEventListener("keydown",e=>{e.key==="Escape"&&u()});N();V();const g=["items","plans","addons","form"];let P="",p=!1,k=!1;const K=document.getElementById("viewPlanBtnText")?.textContent||"檢視方案詳情",Q="聯絡我們",U=()=>{const e=document.getElementById("viewPlanBtnText");e&&(p?e.textContent=Q:e.textContent=K)},x=()=>{const e=document.querySelectorAll(".interest-button");let t=!1,n="";for(const i of g){const r=document.getElementById(i);if(r){const a=r.getBoundingClientRect(),c=a.height;if(Math.min(a.bottom,window.innerHeight)-Math.max(a.top,0)>c*.3){n=i;break}}}n&&n!==P&&(P=n,n==="plans"&&!p&&(p=!0,U()));const s=document.getElementById(g[0]),o=document.getElementById(g[g.length-1]);if(s&&o){const i=s.getBoundingClientRect(),r=o.getBoundingClientRect(),a=window.innerHeight;t=i.top<a&&r.bottom>0}t!==k&&(k=t,e.forEach(i=>{const r=i;r.style.display=t?"flex":"none"}))};let E;const X=()=>{E&&cancelAnimationFrame(E),E=requestAnimationFrame(x)};document.addEventListener("scroll",X);window.addEventListener("resize",x);setTimeout(x,100);window.addEventListener("itemsChange",V);document.addEventListener("interested-items-changed",S);j();S();
