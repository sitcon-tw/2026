import{i as N,r as V,a as W,g as u}from"./local-storage.yZB-lsyX.js";document.addEventListener("DOMContentLoaded",function(){const c=document.getElementById("expandButton"),m=document.querySelector(".cards-container"),h=c?c.querySelector(".show-text"):null,v=c?c.querySelector(".hide-text"):null,y=c?c.querySelector(".arrow"):null;if(!c||!m||!h||!v||!y)return;let E=!1,A=!0;function g(){!A||E?(m.classList.remove("fade-active"),m.classList.add("fade-hidden"),h.style.display="none",v.style.display="inline",y.style.transform="rotate(180deg)"):(m.classList.remove("fade-hidden"),m.classList.add("fade-active"),h.style.display="inline",v.style.display="none",y.style.transform="rotate(0deg)")}c.addEventListener("click",function(){E=!E,g()});function M(t){const n=document.querySelector(".cards-grid");if(!n)return;const e=Array.from(n.querySelectorAll(".card"));let o=e.length;t==="all"?e.sort((i,s)=>{const a=i.getAttribute("data-card-id")||"",r=s.getAttribute("data-card-id")||"";return a.localeCompare(r)}):e.sort((i,s)=>{const a=i.getAttribute("data-category"),r=s.getAttribute("data-category"),l=i.getAttribute("data-card-id")||"",S=s.getAttribute("data-card-id")||"";return a===t&&r!==t?-1:a!==t&&r===t?1:l.localeCompare(S)}),e.forEach(i=>{z(i,t)}),e.forEach(i=>n.appendChild(i)),L(o)}function U(){const t=window.innerWidth;return t<=768?2:t<=1024?4:6}function z(t,n){const e=t.querySelector(".description");if(!e)return;const o=t.getAttribute("data-descriptions");if(o)try{const i=JSON.parse(o),s=i[n]||i.all||"";e.textContent=s}catch{}}function L(t){const n=document.getElementById("expandButton");if(!n)return;const e=U();t>e?(A=!0,n.style.display="flex",g()):(A=!1,n.style.display="none",g())}const C=document.querySelectorAll(".tab");C.forEach(t=>{t.addEventListener("click",function(){const n=t;C.forEach(o=>o.classList.remove("active")),n.classList.add("active");const e=n.getAttribute("data-category")||"all";M(e)})});const F=document.querySelectorAll(".card").length;L(F),g(),window.addEventListener("resize",function(){const t=document.querySelectorAll(".card");L(t.length)});function q(){const t=u(),n=new Set(t.map(e=>e.id));document.querySelectorAll(".add-button").forEach(e=>{const o=e.getAttribute("data-item-id")||"";n.has(o)?e.classList.add("added"):e.classList.remove("added")})}function O(){document.querySelectorAll(".card").forEach(n=>{const e=n.getAttribute("data-card-id");e&&(n.style.cursor="pointer",n.addEventListener("click",function(o){if(o.target.closest(".add-button"))return;o.stopPropagation();const s=`item-popup-${e}`;popupCtrl(s,"open")}))})}function I(){document.querySelectorAll(".card").forEach(n=>{const e=n.getAttribute("data-card-id");e&&(N(e)?n.classList.add("highlighted"):n.classList.remove("highlighted"))})}document.addEventListener("click",function(t){const n=t.target;if(!(n instanceof Element))return;const e=n.closest(".add-button");if(!e)return;t.preventDefault(),t.stopPropagation();const o=e.getAttribute("data-item-id")||"",i=e.getAttribute("data-item-title")||"",s=e.getAttribute("data-item-category")||"",a=e.getAttribute("data-item-image")||"";N(o)?(V(o),e.classList.remove("added")):(W({id:o,title:i,category:s,image:a,deadline:""}),e.classList.add("added"))});function T(){const t=u(),n=document.querySelector(".interest-count");n&&(t.length>0?n.textContent=t.length.toString():n.textContent="")}function P(){const t=u(),n=document.getElementById("interestItemsList");if(!n)return;if(t.length===0){n.innerHTML=`<div class="empty-state">${document.querySelector("[data-i18n-no-items]")?.textContent}</div>`;return}n.innerHTML="";const e=document.getElementById("removeIconTemplate");t.forEach(i=>{const s=document.createElement("div");s.className="interest-item",s.setAttribute("data-item-id",i.id);const a=document.createElement("div");a.className="item-content";const r=document.createElement("span");r.className="item-title",r.textContent=i.title;const l=document.createElement("button");if(l.className="remove-item",l.setAttribute("data-item-id",i.id),e){const S=e.content.cloneNode(!0);l.appendChild(S)}a.appendChild(r),a.appendChild(l),s.appendChild(a),n.appendChild(s)}),n.querySelectorAll(".remove-item").forEach(i=>{i.addEventListener("click",function(s){s.stopPropagation();const a=i.getAttribute("data-item-id")||"";V(a)})})}let B=u().length;window.addEventListener("itemsChange",function(t){T(),P(),I();let n=B;try{const e=t;e?.detail&&Array.isArray(e.detail.items)?n=e.detail.items.length:n=u().length}catch{n=u().length}n>B&&setTimeout(()=>k(),0),B=n});const b=document.getElementById("interestButton"),d=document.getElementById("interestPopover");function k(){d&&(P(),d.classList.add("active"))}function f(){d&&d.classList.remove("active")}b&&b.addEventListener("click",function(t){t.stopPropagation(),d?.classList.contains("active")?f():k()}),document.addEventListener("click",function(t){d?.classList.contains("active")&&!d.contains(t.target)&&!b?.contains(t.target)&&f()}),document.addEventListener("keydown",function(t){t.key==="Escape"&&f()}),document.addEventListener("click",function(t){if(t.target.closest(".view-plan-btn"))if(t.preventDefault(),p){const e=document.getElementById("form");e&&(e.scrollIntoView({behavior:"smooth"}),f())}else{const e=document.getElementById("plans");e&&(e.scrollIntoView({behavior:"smooth"}),f(),p=!0,H())}}),T(),q();const R=["items","plans","addons","form"];let D="",p=!1;const $=document.getElementById("viewPlanBtnText")?.textContent||"檢視方案詳情",G="聯絡我們";function H(){const t=document.getElementById("viewPlanBtnText");t&&(p?t.textContent=G:t.textContent=$)}function w(){const t=document.querySelectorAll(".interest-button");let n="";for(const e of R){const o=document.getElementById(e);if(o){const i=o.getBoundingClientRect(),s=i.height;if(Math.min(i.bottom,window.innerHeight)-Math.max(i.top,0)>s*.3){n=e;break}}}n!==D&&(D=n,n==="plans"&&!p&&(p=!0,H()),t.forEach(e=>{const o=e;n?o.style.display="flex":o.style.display="none"}))}let x;function J(){x&&cancelAnimationFrame(x),x=requestAnimationFrame(w)}document.addEventListener("scroll",J),window.addEventListener("resize",w),setTimeout(w,100),window.addEventListener("itemsChange",q),document.addEventListener("interested-items-changed",I),O(),I()});
