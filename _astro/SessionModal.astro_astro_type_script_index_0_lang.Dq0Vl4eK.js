import{_ as W}from"./preload-helper.BbGayGA1.js";const s=document.getElementById("session-modal"),R=document.getElementById("modal-overlay"),Y=document.getElementById("modal-close"),j=document.getElementById("modal-close-mobile"),E=document.getElementById("share-btn"),w=document.getElementById("modal-ad-link"),T=document.getElementById("modal-ad-image-mobile"),C=document.getElementById("modal-ad-image-desktop"),z=(()=>{if(!s)return[];try{const e=s.getAttribute("data-ads"),t=e?JSON.parse(e):[];return Array.isArray(t)?t.filter(n=>n&&typeof n.name=="string"&&typeof n.link=="string"&&typeof n.weight=="number"&&n.weight>0):[]}catch{return[]}})();function Q(e){if(!e.length)return null;const t=e.reduce((a,d)=>a+d.weight,0);if(t<=0)return null;let n=Math.random()*t;for(const a of e)if(n-=a.weight,n<=0)return a;return e[e.length-1]??null}function U(){if(!w||!T||!C)return;const e=Q(z);if(!e){w.style.display="none";return}w.style.display="",w.href=e.link,T.src=`/2026/img/cool_sponsor/${e.name}-mobile.webp`,T.alt=`${e.name} 橫式廣告`,C.src=`/2026/img/cool_sponsor/${e.name}.webp`,C.alt=`${e.name} 直式廣告`}function S(){if(!s)return;s.classList.add("closing");const t=window.matchMedia("(max-width: 968px)").matches?300:220;setTimeout(()=>{s.classList.remove("active","closing","bookmark-area-hovered"),document.body.style.overflow="";const n=window.lenis;n&&typeof n.start=="function"&&n.start();const a=s.querySelector(".session-content");a&&(a.scrollTop=0),document.dispatchEvent(new CustomEvent("closeSessionModal"))},t)}Y&&Y.addEventListener("click",S);j&&j.addEventListener("click",S);R&&R.addEventListener("click",S);let B=0;function K(){E&&(E.classList.add("is-success"),B&&window.clearTimeout(B),B=window.setTimeout(()=>{E?.classList.remove("is-success")},2e3))}E&&E.addEventListener("click",async()=>{if(navigator.share)try{await navigator.share({title:document.querySelector(".session-title")?.textContent||"",text:document.querySelector(".session-description")?.textContent||"",url:window.location.href}),K()}catch(e){console.log("Error sharing:",e)}else try{await navigator.clipboard.writeText(window.location.href),K()}catch(e){console.log("Error copying:",e)}});const G="sitcon2026:agendaBookmarks",l=document.getElementById("modal-bookmark-ribbon");function V(){try{const e=localStorage.getItem(G);if(!e)return new Set;const t=JSON.parse(e);return Array.isArray(t)?new Set(t.filter(n=>typeof n=="string")):new Set}catch{return new Set}}document.addEventListener("openSessionModal",(e=>{const t=e.detail||{},n=t.id??"",a=t.type??"",d=t.name??"",m=t.description??"",g=t.venue??"",k=t.startTime??"",u=t.endTime??"",b=t.speakers??[],i=t.tags??[],p=t.slidoLink??"",h=t.slidesLink??"",y=t.notesLink??"",P=t.lang??"zh";s&&s.setAttribute("data-session-id",n),l&&(l.classList.toggle("is-bookmarked",n?V().has(n):!1),l.setAttribute("aria-hidden",l.classList.contains("is-bookmarked")?"false":"true"));const _=s?.querySelector(".session-title");_&&(_.textContent=d);const $=s?.querySelector(".session-description");$&&($.innerHTML=m);const D=s?.querySelector(".session-type-badge");if(D){const o={keynote:"Keynote",presentation:"Presentation",undefined:P==="en"?"Undefined":"開放式議程",espresso:"Espresso",sponsored:P==="en"?"Sponsored":"合作議程"};D.textContent=o[a]||""}const O=s?.querySelector(".meta-item:first-child span");if(O){const o=r=>r?new Date(Number(r)).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1,timeZone:"Asia/Taipei"}):"";O.textContent=`${o(k)}${u?` - ${o(u)}`:""}`}const x=s?.querySelector(".meta-item:nth-child(2) span");x&&(x.textContent=g);const N=s?.querySelector(".session-meta");let f=s?.querySelector(".session-tags");N&&(i.length>0?(f||(f=document.createElement("div"),f.className="session-tags",N.appendChild(f)),f.innerHTML=i.map((o,r)=>`<span class="session-tag" id="tag-${r}">#${o}</span>`).join("")):f&&(f.innerHTML=""));const H=s?.querySelector(".session-speaker-detail");H&&(H.innerHTML=b.map(o=>{const r=typeof o=="string"?o:o.name,I=typeof o=="object"?`<img src="${o.avatar}" alt="${r}" onerror="this.onerror=null; this.src='https://sitcon.org/2022/imgs/deafult_avatar.jpg'" />`:null;return`<article>
									${I}
									<div>
										<h2>${I}<span>${r}</span></h2>
										${(o.description||"").replace(/\n/g,"<br />")}
									</div>
								</article>`}).join(""));const v=s?.querySelector(".session-actions");v&&(v.querySelector("a[href*='slido'], a:first-of-type"),v.querySelectorAll("a")[1],v.querySelectorAll("a")[2],v.querySelectorAll("a").forEach((o,r)=>{r===0&&p?(o.href=p,o.style.display=""):r===0&&(o.style.display="none"),r===1&&y?(o.href=y,o.style.display=""):r===1&&(o.style.display="none"),r===2&&h?(o.href=h,o.style.display=""):r===2&&(o.style.display="none")})),U(),s?.classList.add("active");const A=window.lenis;A&&typeof A.stop=="function"&&A.stop()}));function J(e){try{localStorage.setItem(G,JSON.stringify(Array.from(e)))}catch{}}const L=document.getElementById("modal-bookmark-area");L&&l&&s&&(L.addEventListener("mouseenter",()=>{s.classList.add("bookmark-area-hovered")}),L.addEventListener("mouseleave",()=>{s.classList.remove("bookmark-area-hovered")}),L.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();const t=s.getAttribute("data-session-id")??"";if(!t)return;const n=V();n.has(t)?(n.delete(t),J(n),l.classList.remove("is-bookmarked"),l.setAttribute("aria-hidden","true")):(n.add(t),J(n),l.classList.add("is-bookmarked"),l.setAttribute("aria-hidden","false")),document.dispatchEvent(new CustomEvent("bookmarksChanged",{detail:{sessionId:t}}))}));document.addEventListener("keydown",e=>{e.key==="Escape"&&s?.classList.contains("active")&&S()});const M=document.getElementById("modal-container"),q=document.getElementById("modal-drag-handle"),Z=window.matchMedia("(max-width: 968px)"),F=80;let c=null;W(async()=>{const{gsap:e}=await import("./index.CMq3EfTn.js");return{gsap:e}},[]).then(({gsap:e})=>{c=e});function X(){if(!M||!q||!s)return;const e=M,t=q,n=s;let a=0,d=0,m=null,g=!1;function k(i){if(!g||i.pointerId!==m)return;i.preventDefault();const p=i.clientY;d=Math.max(0,p-a),c&&c.set(e,{y:d})}function u(i){if(i.pointerId===m){if(g=!1,document.removeEventListener("pointermove",k),document.removeEventListener("pointerup",u),document.removeEventListener("pointercancel",u),m!=null&&t.releasePointerCapture?.(m),e.classList.remove("dragging"),!c){e.style.transform="";return}if(d>=F){const p=e.getBoundingClientRect().height,h=n.querySelector(".session-content");h&&(h.scrollTop=0),c.to(e,{y:p,duration:.25,ease:"power2.in",onComplete:()=>{c?.set(e,{clearProps:"y"}),n.classList.remove("active","closing","bookmark-area-hovered"),document.body.style.overflow="";const y=window.lenis;y&&typeof y.start=="function"&&y.start(),document.dispatchEvent(new CustomEvent("closeSessionModal"))}})}else c.to(e,{y:0,duration:.3,ease:"power2.out",onComplete:()=>c?.set(e,{clearProps:"y"})})}}function b(i){!Z.matches||!n.classList.contains("active")||(i.preventDefault(),i.stopPropagation(),a=i.clientY,d=0,m=i.pointerId,g=!0,e.classList.add("dragging"),c&&c.killTweensOf(e),t.setPointerCapture?.(i.pointerId),document.addEventListener("pointermove",k,{passive:!1}),document.addEventListener("pointerup",u,{once:!0}),document.addEventListener("pointercancel",u,{once:!0}))}t.addEventListener("pointerdown",b,{passive:!1})}q&&M&&X();window.openSessionModal=()=>{s&&(U(),s.classList.add("active"))};
