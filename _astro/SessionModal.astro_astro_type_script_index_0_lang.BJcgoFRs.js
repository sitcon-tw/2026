import{_ as j}from"./preload-helper.BbGayGA1.js";const s=document.getElementById("session-modal"),x=document.getElementById("modal-overlay"),H=document.getElementById("modal-close"),N=document.getElementById("modal-close-mobile"),E=document.getElementById("share-btn");function w(){if(!s)return;s.classList.add("closing");const t=window.matchMedia("(max-width: 968px)").matches?300:220;setTimeout(()=>{s.classList.remove("active","closing","bookmark-area-hovered"),document.body.style.overflow="";const o=window.lenis;o&&typeof o.start=="function"&&o.start();const d=s.querySelector(".session-content");d&&(d.scrollTop=0),document.dispatchEvent(new CustomEvent("closeSessionModal"))},t)}H&&H.addEventListener("click",w);N&&N.addEventListener("click",w);x&&x.addEventListener("click",w);let I=0;function R(){E&&(E.classList.add("is-success"),I&&window.clearTimeout(I),I=window.setTimeout(()=>{E?.classList.remove("is-success")},2e3))}E&&E.addEventListener("click",async()=>{if(navigator.share)try{await navigator.share({title:document.querySelector(".session-title")?.textContent||"",text:document.querySelector(".session-description")?.textContent||"",url:window.location.href}),R()}catch(e){console.log("Error sharing:",e)}else try{await navigator.clipboard.writeText(window.location.href),R()}catch(e){console.log("Error copying:",e)}});const K="sitcon2026:agendaBookmarks",l=document.getElementById("modal-bookmark-ribbon");function U(){try{const e=localStorage.getItem(K);if(!e)return new Set;const t=JSON.parse(e);return Array.isArray(t)?new Set(t.filter(o=>typeof o=="string")):new Set}catch{return new Set}}document.addEventListener("openSessionModal",(e=>{const t=e.detail||{},o=t.id??"",d=t.type??"",f=t.name??"",c=t.description??"",g=t.venue??"",L=t.startTime??"",m=t.endTime??"",S=t.speakers??[],i=t.tags??[],p=t.slidoLink??"",v=t.slidesLink??"",y=t.notesLink??"",B=t.lang??"zh";s&&s.setAttribute("data-session-id",o),l&&(l.classList.toggle("is-bookmarked",o?U().has(o):!1),l.setAttribute("aria-hidden",l.classList.contains("is-bookmarked")?"false":"true"));const M=s?.querySelector(".session-title");M&&(M.textContent=f);const b=s?.querySelector(".session-description");b&&j(async()=>{const{marked:n}=await import("./marked.esm.7nWwd-IH.js");return{marked:n}},[]).then(({marked:n})=>{b.innerHTML=c?n.parse(c):""}).catch(()=>{b.textContent=c});const P=s?.querySelector(".session-type-badge");if(P){const n={keynote:"Keynote",presentation:"Presentation",undefined:B==="en"?"Undefined":"開放式議程",espresso:"Espresso",sponsored:B==="en"?"Sponsored":"合作議程"};P.textContent=n[d]||""}const q=s?.querySelector(".meta-item:first-child span");if(q){const n=r=>r?new Date(Number(r)).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1,timeZone:"Asia/Taipei"}):"";q.textContent=`${n(L)}${m?` - ${n(m)}`:""}`}const D=s?.querySelector(".meta-item:nth-child(2) span");D&&(D.textContent=g);const O=s?.querySelector(".session-meta");let u=s?.querySelector(".session-tags");O&&(i.length>0?(u||(u=document.createElement("div"),u.className="session-tags",O.appendChild(u)),u.innerHTML=i.map((n,r)=>`<span class="session-tag" id="tag-${r}">#${n}</span>`).join("")):u&&(u.innerHTML=""));const $=s?.querySelector(".session-speaker-detail");$&&($.innerHTML=S.map(n=>{const r=typeof n=="string"?n:n.name,C=typeof n=="object"?`<img src="${n.avatar}" alt="${r}" onerror="this.onerror=null; this.src='https://sitcon.org/2022/imgs/deafult_avatar.jpg'" />`:null;return`<article>
									${C}
									<div>
										<h2>${C}<span>${r}</span></h2>
										<p>${(n.description||"").replace(/\n/g,"<br />")}</p>
									</div>
								</article>`}).join(""));const h=s?.querySelector(".session-actions");h&&(h.querySelector("a[href*='slido'], a:first-of-type"),h.querySelectorAll("a")[1],h.querySelectorAll("a")[2],h.querySelectorAll("a").forEach((n,r)=>{r===0&&p?(n.href=p,n.style.display=""):r===0&&(n.style.display="none"),r===1&&y?(n.href=y,n.style.display=""):r===1&&(n.style.display="none"),r===2&&v?(n.href=v,n.style.display=""):r===2&&(n.style.display="none")})),s?.classList.add("active");const T=window.lenis;T&&typeof T.stop=="function"&&T.stop()}));function Y(e){try{localStorage.setItem(K,JSON.stringify(Array.from(e)))}catch{}}const k=document.getElementById("modal-bookmark-area");k&&l&&s&&(k.addEventListener("mouseenter",()=>{s.classList.add("bookmark-area-hovered")}),k.addEventListener("mouseleave",()=>{s.classList.remove("bookmark-area-hovered")}),k.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();const t=s.getAttribute("data-session-id")??"";if(!t)return;const o=U();o.has(t)?(o.delete(t),Y(o),l.classList.remove("is-bookmarked"),l.setAttribute("aria-hidden","true")):(o.add(t),Y(o),l.classList.add("is-bookmarked"),l.setAttribute("aria-hidden","false")),document.dispatchEvent(new CustomEvent("bookmarksChanged",{detail:{sessionId:t}}))}));document.addEventListener("keydown",e=>{e.key==="Escape"&&s?.classList.contains("active")&&w()});const _=document.getElementById("modal-container"),A=document.getElementById("modal-drag-handle"),V=window.matchMedia("(max-width: 968px)"),G=80;let a=null;j(async()=>{const{gsap:e}=await import("./index.CMq3EfTn.js");return{gsap:e}},[]).then(({gsap:e})=>{a=e});function J(){if(!_||!A||!s)return;const e=_,t=A,o=s;let d=0,f=0,c=null,g=!1;function L(i){if(!g||i.pointerId!==c)return;i.preventDefault();const p=i.clientY;f=Math.max(0,p-d),a&&a.set(e,{y:f})}function m(i){if(i.pointerId===c){if(g=!1,document.removeEventListener("pointermove",L),document.removeEventListener("pointerup",m),document.removeEventListener("pointercancel",m),c!=null&&t.releasePointerCapture?.(c),e.classList.remove("dragging"),!a){e.style.transform="";return}if(f>=G){const p=e.getBoundingClientRect().height,v=o.querySelector(".session-content");v&&(v.scrollTop=0),a.to(e,{y:p,duration:.25,ease:"power2.in",onComplete:()=>{a?.set(e,{clearProps:"y"}),o.classList.remove("active","closing","bookmark-area-hovered"),document.body.style.overflow="";const y=window.lenis;y&&typeof y.start=="function"&&y.start(),document.dispatchEvent(new CustomEvent("closeSessionModal"))}})}else a.to(e,{y:0,duration:.3,ease:"power2.out",onComplete:()=>a?.set(e,{clearProps:"y"})})}}function S(i){!V.matches||!o.classList.contains("active")||(i.preventDefault(),i.stopPropagation(),d=i.clientY,f=0,c=i.pointerId,g=!0,e.classList.add("dragging"),a&&a.killTweensOf(e),t.setPointerCapture?.(i.pointerId),document.addEventListener("pointermove",L,{passive:!1}),document.addEventListener("pointerup",m,{once:!0}),document.addEventListener("pointercancel",m,{once:!0}))}t.addEventListener("pointerdown",S,{passive:!1})}A&&_&&J();window.openSessionModal=()=>{s&&s.classList.add("active")};
