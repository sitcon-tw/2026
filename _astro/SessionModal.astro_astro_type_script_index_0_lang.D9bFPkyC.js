import{_ as W}from"./preload-helper.BbGayGA1.js";const o=document.getElementById("session-modal"),R=document.getElementById("modal-overlay"),Y=document.getElementById("modal-close"),j=document.getElementById("modal-close-mobile"),E=document.getElementById("share-btn"),w=document.getElementById("modal-ad-link"),T=document.getElementById("modal-ad-image-mobile"),M=document.getElementById("modal-ad-image-desktop"),z=(()=>{if(!o)return[];try{const e=o.getAttribute("data-ads"),n=e?JSON.parse(e):[];return Array.isArray(n)?n.filter(t=>t&&typeof t.name=="string"&&typeof t.link=="string"&&typeof t.weight=="number"&&t.weight>0&&(typeof t.mobile>"u"||typeof t.mobile=="boolean")&&(typeof t.desktop>"u"||typeof t.desktop=="boolean")):[]}catch{return[]}})();function Q(e,n){return n?e.mobile===!0:e.desktop===!0}function Z(e){if(!e.length)return null;const n=e.reduce((i,d)=>i+d.weight,0);if(n<=0)return null;let t=Math.random()*n;for(const i of e)if(t-=i.weight,t<=0)return i;return e[e.length-1]??null}function U(){if(!w||!T||!M)return;const e=window.matchMedia("(max-width: 968px)").matches,n=z.filter(i=>Q(i,e)),t=Z(n);if(!t){w.style.display="none";return}w.style.display="",w.href=t.link,T.src=`/2026/img/cool_sponsor/${t.name}-mobile.webp`,T.alt=`${t.name} 橫式廣告`,M.src=`/2026/img/cool_sponsor/${t.name}.webp`,M.alt=`${t.name} 直式廣告`}function b(){if(!o)return;o.classList.add("closing");const n=window.matchMedia("(max-width: 968px)").matches?300:220;setTimeout(()=>{o.classList.remove("active","closing","bookmark-area-hovered"),document.body.style.overflow="";const t=window.lenis;t&&typeof t.start=="function"&&t.start();const i=o.querySelector(".session-content");i&&(i.scrollTop=0),document.dispatchEvent(new CustomEvent("closeSessionModal"))},n)}Y&&Y.addEventListener("click",b);j&&j.addEventListener("click",b);R&&R.addEventListener("click",b);let C=0;function K(){E&&(E.classList.add("is-success"),C&&window.clearTimeout(C),C=window.setTimeout(()=>{E?.classList.remove("is-success")},2e3))}E&&E.addEventListener("click",async()=>{if(navigator.share)try{await navigator.share({title:document.querySelector(".session-title")?.textContent||"",text:document.querySelector(".session-description")?.textContent||"",url:window.location.href}),K()}catch(e){console.log("Error sharing:",e)}else try{await navigator.clipboard.writeText(window.location.href),K()}catch(e){console.log("Error copying:",e)}});const G="sitcon2026:agendaBookmarks",l=document.getElementById("modal-bookmark-ribbon");function V(){try{const e=localStorage.getItem(G);if(!e)return new Set;const n=JSON.parse(e);return Array.isArray(n)?new Set(n.filter(t=>typeof t=="string")):new Set}catch{return new Set}}document.addEventListener("openSessionModal",(e=>{const n=e.detail||{},t=n.id??"",i=n.type??"",d=n.name??"",m=n.description??"",g=n.venue??"",k=n.startTime??"",u=n.endTime??"",S=n.speakers??[],r=n.tags??[],p=n.slidoLink??"",h=n.slidesLink??"",y=n.notesLink??"",q=n.lang??"zh";o&&o.setAttribute("data-session-id",t),l&&(l.classList.toggle("is-bookmarked",t?V().has(t):!1),l.setAttribute("aria-hidden",l.classList.contains("is-bookmarked")?"false":"true"));const _=o?.querySelector(".session-title");_&&(_.textContent=d);const $=o?.querySelector(".session-description");$&&($.innerHTML=m);const D=o?.querySelector(".session-type-badge");if(D){const s={keynote:"Keynote",presentation:"Presentation",undefined:q==="en"?"Undefined":"開放式議程",espresso:"Espresso",sponsored:q==="en"?"Sponsored":"合作議程"};D.textContent=s[i]||""}const O=o?.querySelector(".meta-item:first-child span");if(O){const s=a=>a?new Date(Number(a)).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1,timeZone:"Asia/Taipei"}):"";O.textContent=`${s(k)}${u?` - ${s(u)}`:""}`}const x=o?.querySelector(".meta-item:nth-child(2) span");x&&(x.textContent=g);const N=o?.querySelector(".session-meta");let f=o?.querySelector(".session-tags");N&&(r.length>0?(f||(f=document.createElement("div"),f.className="session-tags",N.appendChild(f)),f.innerHTML=r.map((s,a)=>`<span class="session-tag" id="tag-${a}">#${s}</span>`).join("")):f&&(f.innerHTML=""));const H=o?.querySelector(".session-speaker-detail");H&&(H.innerHTML=S.map(s=>{const a=typeof s=="string"?s:s.name,I=typeof s=="object"?`<img src="${s.avatar}" alt="${a}" onerror="this.onerror=null; this.src='https://sitcon.org/2022/imgs/deafult_avatar.jpg'" />`:null;return`<article>
									${I}
									<div>
										<h2>${I}<span>${a}</span></h2>
										${(s.description||"").replace(/\n/g,"<br />")}
									</div>
								</article>`}).join(""));const v=o?.querySelector(".session-actions");v&&(v.querySelector("a[href*='slido'], a:first-of-type"),v.querySelectorAll("a")[1],v.querySelectorAll("a")[2],v.querySelectorAll("a").forEach((s,a)=>{a===0&&p?(s.href=p,s.style.display=""):a===0&&(s.style.display="none"),a===1&&y?(s.href=y,s.style.display=""):a===1&&(s.style.display="none"),a===2&&h?(s.href=h,s.style.display=""):a===2&&(s.style.display="none")})),U(),o?.classList.add("active");const A=window.lenis;A&&typeof A.stop=="function"&&A.stop()}));function J(e){try{localStorage.setItem(G,JSON.stringify(Array.from(e)))}catch{}}const L=document.getElementById("modal-bookmark-area");L&&l&&o&&(L.addEventListener("mouseenter",()=>{o.classList.add("bookmark-area-hovered")}),L.addEventListener("mouseleave",()=>{o.classList.remove("bookmark-area-hovered")}),L.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();const n=o.getAttribute("data-session-id")??"";if(!n)return;const t=V();t.has(n)?(t.delete(n),J(t),l.classList.remove("is-bookmarked"),l.setAttribute("aria-hidden","true")):(t.add(n),J(t),l.classList.add("is-bookmarked"),l.setAttribute("aria-hidden","false")),document.dispatchEvent(new CustomEvent("bookmarksChanged",{detail:{sessionId:n}}))}));document.addEventListener("keydown",e=>{e.key==="Escape"&&o?.classList.contains("active")&&b()});const B=document.getElementById("modal-container"),P=document.getElementById("modal-drag-handle"),F=window.matchMedia("(max-width: 968px)"),X=80;let c=null;W(async()=>{const{gsap:e}=await import("./index.CMq3EfTn.js");return{gsap:e}},[]).then(({gsap:e})=>{c=e});function ee(){if(!B||!P||!o)return;const e=B,n=P,t=o;let i=0,d=0,m=null,g=!1;function k(r){if(!g||r.pointerId!==m)return;r.preventDefault();const p=r.clientY;d=Math.max(0,p-i),c&&c.set(e,{y:d})}function u(r){if(r.pointerId===m){if(g=!1,document.removeEventListener("pointermove",k),document.removeEventListener("pointerup",u),document.removeEventListener("pointercancel",u),m!=null&&n.releasePointerCapture?.(m),e.classList.remove("dragging"),!c){e.style.transform="";return}if(d>=X){const p=e.getBoundingClientRect().height,h=t.querySelector(".session-content");h&&(h.scrollTop=0),c.to(e,{y:p,duration:.25,ease:"power2.in",onComplete:()=>{c?.set(e,{clearProps:"y"}),t.classList.remove("active","closing","bookmark-area-hovered"),document.body.style.overflow="";const y=window.lenis;y&&typeof y.start=="function"&&y.start(),document.dispatchEvent(new CustomEvent("closeSessionModal"))}})}else c.to(e,{y:0,duration:.3,ease:"power2.out",onComplete:()=>c?.set(e,{clearProps:"y"})})}}function S(r){!F.matches||!t.classList.contains("active")||(r.preventDefault(),r.stopPropagation(),i=r.clientY,d=0,m=r.pointerId,g=!0,e.classList.add("dragging"),c&&c.killTweensOf(e),n.setPointerCapture?.(r.pointerId),document.addEventListener("pointermove",k,{passive:!1}),document.addEventListener("pointerup",u,{once:!0}),document.addEventListener("pointercancel",u,{once:!0}))}n.addEventListener("pointerdown",S,{passive:!1})}P&&B&&ee();window.openSessionModal=()=>{o&&(U(),o.classList.add("active"))};
