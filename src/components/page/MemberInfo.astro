---
const { id = "member-info-modal" } = Astro.props;
---

<div id={id} class="member-info" style="display: none;">
	<div class="header">
		<button class="close-btn">
			<svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" viewBox="0 0 21 21" fill="none">
				<path d="M19 2L2 19M2 2L19 19" stroke="white" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"></path>
			</svg>
		</button>
	</div>
	<h1 id="member-name"></h1>
	<h2 id="member-position"></h2>
	<div class="avatar">
		<img id="member-avatar-img" class="avatar-img" src="" alt="" />
	</div>
	<p>SITCON 年會每年皆是許多志工奉獻時間與精神所舉辦，沒有大家的付出，就不可能會有如此內容豐富且高品質的年會， 希望大家在參加之餘，也不要忘記背後工作人員的付出。</p>
	<div class="social">
		<button id="member-social-btn" data-url="">Link</button>
	</div>
</div>

<script>
	const KNOWN_SITES = {
		"instagram.com": "Instagram",
		"github.com": "GitHub",
		"facebook.com": "Facebook",
		"youtube.com": "YouTube",
		"twitter.com": "Twitter",
		"x.com": "X",
		"linkedin.com": "LinkedIn",
		"plurk.com": "Plurk",
		"medium.com": "Medium"
	};

	function getSocialText(url: string) {
		try {
			const urlObj = new URL(url);
			const hostname = urlObj.hostname;
			let siteName = "";
			for (const [domain, name] of Object.entries(KNOWN_SITES)) {
				if (hostname === domain || hostname.endsWith("." + domain)) {
					siteName = name;
					break;
				}
			}
			return siteName ? `前往 ${siteName}` : `前往 ${hostname.replace(/^www\./, "")}`;
		} catch (e) {
			return `前往 ${url}`;
		}
	}

	// Open modal logic with data injection
	document.addEventListener("click", e => {
		const target = e.target as HTMLElement;
		const trigger = target.closest(".person-trigger") as HTMLElement | null;
		if (trigger) {
			const { name, position, avatar, social } = trigger.dataset;

			const modal = document.getElementById("member-info-modal");
			if (modal) {
				// Update Text
				const nameEl = modal.querySelector("#member-name");
				const posEl = modal.querySelector("#member-position");
				if (nameEl) nameEl.textContent = name || "";
				if (posEl) posEl.textContent = position || "";

				// Update Avatar
				const avatarImg = modal.querySelector("#member-avatar-img") as HTMLImageElement | null;
				if (avatarImg) {
					avatarImg.src = avatar || "";
					avatarImg.alt = `${name} avatar`;
					avatarImg.setAttribute("object-fit", "contain");
				}

				// Update Social Button
				const socialBtn = modal.querySelector("#member-social-btn") as HTMLElement | null;
				if (socialBtn) {
					socialBtn.setAttribute("data-url", social || "");
					socialBtn.textContent = getSocialText(social || "");
					socialBtn.style.display = social ? "inline-block" : "none";
				}

				modal.style.display = "block";
			}
		}
	});

	// Close modal logic
	document.addEventListener("click", e => {
		const target = e.target as HTMLElement;
		const closeBtn = target.closest(".member-info .close-btn");
		if (closeBtn) {
			const modal = closeBtn.closest(".member-info") as HTMLElement | null;
			if (modal) {
				modal.style.display = "none";
			}
		}
	});

	// Social Button Click Logic
	document.addEventListener("click", e => {
		const target = e.target as HTMLElement;
		if (target.id === "member-social-btn") {
			const url = target.getAttribute("data-url");
			if (url) window.open(url, "_blank");
		}
	});
</script>

<style>
	.member-info {
		color: black;
		background-color: white;
		width: 40rem;
		max-width: 40vw;
		height: 100vh;
		position: fixed;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		padding: 4rem;
		box-shadow: 0 0 1rem rgba(0, 0, 0, 0.1);
		z-index: 101;
		overflow-y: auto;
	}

	@media (max-width: 48rem) {
		.member-info {
			min-width: 90vw;
			min-height: 90vh;
			align-self: center;
			justify-self: center;
			position: fixed;
			padding: 2.5rem;
		}
	}

	.header {
		padding-bottom: 1.5rem;
	}

	@media (max-width: 48rem) {
		.header {
			padding-bottom: 3.5rem;
		}
	}

	.close-btn {
		border-radius: 62rem;
		justify-content: center;
		align-items: center;
		width: 3.5rem;
		height: 3.5rem;
		position: absolute;
		top: 3rem;
		right: 3rem;
		font-size: 2rem;
		font-weight: 700;
		background-color: black;
		color: white;
		cursor: pointer;
		display: flex;
		border: none;
	}

	@media (max-width: 48rem) {
		.close-btn {
			top: 2rem;
			right: 2rem;
			font-size: 1.5rem;
		}
	}

	h1 {
		font-family: "GenKiGothic2 TW";
		font-size: 5.25rem;
		font-weight: 700;
	}

	@media (max-width: 48rem) {
		h1 {
			font-size: 3.5rem;
		}
	}

	h2 {
		font-family: "GenKiGothic2 TW";
		font-size: 1rem;
		font-weight: 700;
		padding: 1.5rem 0;
		line-height: 1.5;
	}

	.avatar,
	.social {
		justify-self: end;
	}

	@media (max-width: 48rem) {
		.avatar,
		.social {
			justify-self: center;
		}
	}

	.social {
		margin-bottom: 3rem;
		align-self: flex-end;
	}

	#member-social-btn {
		padding: 0.5rem 1rem;
		background-color: #000;
		color: #fff;
		border: none;
		border-radius: 0.3rem;
		cursor: pointer;
		font-size: 1rem;
		font-weight: 700;
	}

	p {
		font-family: "GenKiGothic2 TW";
		width: 20rem;
		padding-top: 3.75rem;
		font-size: 1rem;
		font-weight: 700;
		line-height: 1.5;
	}

	@media (max-width: 48rem) {
		p {
			width: 100%;
		}
	}

	.avatar-img {
		width: 10rem;
		height: 10rem;
		border-radius: 16px;
		background-color: #fff;
		object-fit: contain;
	}
</style>
