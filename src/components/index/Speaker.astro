---
const speakers = [
	{
		name: "OsGa",
		desc: "崴崴孟孟旅行三百天",
		img: "https://placehold.co/367x492/png?text=OsGa"
	},
	{
		name: "毛哥em",
		desc: "厲害崴孟讓旅途順暢無阻",
		img: "https://placehold.co/367x492/png?text=em"
	},
	{
		name: "凱文 kevin",
		desc: "崴孟合作 什麼難關都不怕",
		img: "https://placehold.co/367x492/png?text=kevin"
	},
	{
		name: "紐爾森 nelson",
		desc: "孟寶總是心暖暖 因為崴崴寶",
		img: "https://placehold.co/367x492/png?text=nelson"
	},
	{
		name: "yc油成",
		desc: "擁有豐富的數學背景",
		img: "https://placehold.co/367x492/png?text=yc"
	}
];
---

<section class="speaker-section">
	<div class="title">
		<h2 class="text-reveal-title">年會</h2>
		<div class="line"></div>
		<h2 class="text-reveal-title">邀請講者</h2>
	</div>

	<div class="content-wrapper">
		<div class="speaker-list">
			{
				speakers.map((person, index) => (
					<div class:list={["speaker-item", { active: index === 0 }]} data-img={person.img}>
						<h2 class="text-reveal-title">{person.name}</h2>
						<p class="speakerdesc text-reveal-paragraph">{person.desc}</p>
					</div>
				))
			}
		</div>

		<div class="speaker-image">
			<img id="speaker-img" class="desktop-img" src={speakers[0].img} alt="speaker" />

			<div class="marquee-container">
				<div class="marquee-track">
					{speakers.map(person => <img class="marquee-item" src={person.img} alt={person.name} />)}
					{speakers.map(person => <img class="marquee-item" src={person.img} alt={person.name} />)}
				</div>
			</div>
		</div>
	</div>

	<a href="#" class="cta-btn">查看議程表</a>

	<div class="bg-optimized">
		<svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
			<defs>
				<path id="gentle-wave" d="m-160 44c30 0 58-8 88-8s 58 4 88 8 58-8 88-8 58 8 88 8 v44h-352z"></path>
			</defs>
			<g class="parallax">
				<use xlink:href="#gentle-wave" x="48" y="0" fill="rgba(161, 161, 161, 0.34)"></use>
				<use xlink:href="#gentle-wave" x="48" y="3" fill="rgba(217, 217, 217, 0.34)"></use>
				<use xlink:href="#gentle-wave" x="48" y="5" fill="rgba(205, 205, 205, 0.34)"></use>
				<use xlink:href="#gentle-wave" x="48" y="7" fill="#e0e0e0"></use>
			</g>
		</svg>
	</div>
</section>

<style>
	@keyframes scroll {
		0% {
			transform: translatex(0);
		}
		100% {
			transform: translatex(-50%);
		}
	}

	@keyframes move-forever {
		0% {
			transform: translate3d(-5.625rem, 0, 0);
		}
		100% {
			transform: translate3d(5.3125rem, 0, 0);
		}
	}

	.speaker-section {
		position: relative;
		background-color: #f4f4f4;
		padding: 4rem 2rem 8rem 2rem;
		display: flex;
		flex-direction: column;
		align-items: center;
		overflow: hidden;
	}

	.title {
		width: 100%;
		max-width: var(--max-width);
		margin-bottom: 3rem;
		color: #a79164;
		display: grid;
		grid-template-columns: max-content 1fr max-content;
		align-items: center;
		gap: 2rem;
	}

	.title h2 {
		font-size: 5rem;
		margin: 0;
		font-weight: 600;
		white-space: nowrap;
	}

	.line {
		height: 0.0625rem;
		background-color: #a79164;
		width: 100%;
		justify-self: center;
	}

	.content-wrapper {
		width: 100%;
		max-width: 65rem;
		display: grid;
		grid-template-columns: 1fr 24rem;
		gap: 0;
		align-items: center;
	}

	.speaker-list {
		display: flex;
		flex-direction: column;
		width: 100%;
		gap: 3rem;
	}

	.speaker-item {
		width: 100%;
		font-size: 3rem;
		font-weight: bold;
		color: rgba(169, 124, 33, 0.3);
		cursor: pointer;
		transition: 0.3s;
		display: flex;
		flex-direction: column;
		text-align: left;
		padding-right: 2rem;
		box-sizing: border-box;
	}

	.speaker-item h2 {
		margin: 0;
		font-size: inherit;
		font-weight: inherit;
		color: inherit;
	}

	.speaker-item.active {
		color: #a79164;
		transform: scale(1.1);
		transform-origin: left center;
	}

	.speakerdesc {
		display: none;
	}

	.speaker-image {
		width: 100%;
		display: block;
		perspective: 62.5rem;
		margin: 0;
	}

	.desktop-img {
		display: block;
		width: 100%;
		height: auto;
		border-radius: 0.5rem;
		box-shadow: 0 0.625rem 1.25rem rgba(0, 0, 0, 0.1);
		transform-style: preserve-3d;
		transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
	}

	.marquee-container {
		display: none;
	}

	.cta-btn {
		display: inline-block;
		text-decoration: none;
		font-family: sans-serif;
		font-weight: 700;
		font-size: 1.5rem;
		letter-spacing: 0.05em;
		color: #4f4031;
		padding: 0.75rem 3rem;
		margin-top: 5rem;
		border: 0.125rem solid #4f4031;
		border-radius: 624.9375rem;
		background: linear-gradient(180deg, #e6dac0 0%, #c4b188 100%);
		transition:
			transform 0.2s,
			filter 0.2s;
	}

	.cta-btn:hover {
		transform: translatey(-0.125rem);
		filter: brightness(1.05);
	}

	.title,
	.content-wrapper,
	.cta-btn {
		position: relative;
		z-index: 1;
	}

	.bg-optimized {
		position: absolute;
		top: auto;
		bottom: 0;
		left: 0;
		width: 100%;
		height: 80%;
		pointer-events: none;
		z-index: 0;
		overflow: hidden;
	}

	.waves {
		position: absolute;
		bottom: 0;
		left: 0;
		width: 100%;
		height: 100%;
		min-height: 6.25rem;
	}

	.parallax > use {
		animation: move-forever 25s cubic-bezier(0.55, 0.5, 0.45, 0.5) infinite;
	}

	.parallax > use:nth-child(1) {
		animation-delay: -2s;
		animation-duration: 7s;
	}
	.parallax > use:nth-child(2) {
		animation-delay: -3s;
		animation-duration: 10s;
	}
	.parallax > use:nth-child(3) {
		animation-delay: -4s;
		animation-duration: 13s;
	}
	.parallax > use:nth-child(4) {
		animation-delay: -5s;
		animation-duration: 20s;
	}

	@media (max-width: 900px) {
		.speaker-section {
			padding: 3rem 1.5rem 8rem 1.5rem;
		}

		.title {
			width: 100%;
			margin-bottom: 2rem;
			grid-template-columns: max-content 1fr;
			row-gap: 0.5rem;
			column-gap: 0.9375rem;
			align-items: center;
		}

		.title h2 {
			font-size: 3rem;
			margin: 0;
			line-height: 1;
		}

		.line {
			width: 100%;
			margin: 0;
			align-self: center;
		}

		.title h2:nth-of-type(2) {
			grid-column: 1 / -1;
			margin-left: 2rem;
		}

		.content-wrapper {
			grid-template-columns: 1fr;
			gap: 2.5rem;
			max-width: 100%;
		}

		.speaker-list {
			align-items: flex-start;
			width: 100%;
			gap: 1.5rem;
		}

		.speaker-item {
			font-size: 1.5rem;
			align-items: flex-start;
			width: 100%;
			text-align: left;
			padding-right: 0;
		}

		.speaker-item.active {
			transform-origin: left center;
		}

		.speakerdesc {
			display: block;
			font-size: 1rem;
			font-weight: normal;
			margin-top: 0.5rem;
			color: #4f4031;
			opacity: 1;
		}

		.speaker-image {
			width: calc(100% + 3rem);
			margin-left: -1.5rem;
			overflow: hidden;
			margin-top: 2rem;
		}

		.desktop-img {
			display: none;
		}

		.marquee-container {
			display: block;
			width: 100%;
		}

		.marquee-track {
			display: flex;
			width: max-content;
			gap: 0.625rem;
			animation: scroll 20s linear infinite;
		}

		.marquee-item {
			height: 15.625rem;
			width: auto;
			border-radius: 0.75rem;
			box-shadow: 0 0.3125rem 0.9375rem rgba(0, 0, 0, 0.1);
			flex-shrink: 0;
		}

		.cta-btn {
			width: auto;
			text-align: center;
			padding: 0.625rem 2rem;
			font-size: 1.2rem;
		}

		.bg-optimized {
			height: 70%;
		}
	}
</style>

<script>
	import { gsap } from "gsap";
	const items = document.querySelectorAll(".speaker-item");
	const imgelement = document.getElementById("speaker-img");
	let currentindex = 0;

	function updateview(index: number) {
		items.forEach(item => {
			item.classList.remove("active");
		});

		const targetitem = items[index];
		targetitem.classList.add("active");

		const newimgsrc = targetitem.getAttribute("data-img");
		if (imgelement && newimgsrc) {
			(imgelement as HTMLImageElement).src = newimgsrc;
		}

		currentindex = index;
	}

	items.forEach((item, index) => {
		item.addEventListener("mouseenter", () => {
			updateview(index);
			stopautoplay();
		});

		item.addEventListener("mouseleave", () => {
			startautoplay();
		});
	});

	let timer: number | null = null;

	function startautoplay() {
		if (timer) return;
		timer = window.setInterval(() => {
			const nextindex = (currentindex + 1) % items.length;
			updateview(nextindex);
		}, 2000);
	}

	function stopautoplay() {
		if (timer) window.clearInterval(timer);
		timer = null;
	}

	startautoplay();

	const speakerimage = document.querySelector(".speaker-image");
	const desktopimg = document.querySelector(".desktop-img");

	speakerimage?.addEventListener("mousemove", e => {
		const { clientX, clientY } = e as MouseEvent;
		const { left, top, width, height } = speakerimage.getBoundingClientRect();
		const x = clientX - left;
		const y = clientY - top;
		const rotatex = gsap.utils.mapRange(0, height, -10, 10, y);
		const rotatey = gsap.utils.mapRange(0, width, 10, -10, x);

		gsap.to(desktopimg, {
			rotateX: rotatex,
			rotateY: rotatey,
			duration: 0.4,
			ease: "power2.out"
		});
	});

	speakerimage?.addEventListener("mouseleave", () => {
		gsap.to(desktopimg, {
			rotateX: 0,
			rotateY: 0,
			duration: 0.4,
			ease: "power2.out"
		});
	});
</script>
