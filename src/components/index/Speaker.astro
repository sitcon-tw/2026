---
const speakers = [
	{
		name: "OsGa",
		desc: "崴崴孟孟旅行三百天",
		img: "https://placehold.co/367x492/png?text=OsGa"
	},
	{
		name: "毛哥EM",
		desc: "厲害崴孟讓旅途順暢無阻",
		img: "https://placehold.co/367x492/png?text=EM"
	},
	{
		name: "凱文 Kevin",
		desc: "崴孟合作 什麼難關都不怕",
		img: "https://placehold.co/367x492/png?text=Kevin"
	},
	{
		name: "紐爾森 Nelson",
		desc: "孟寶總是心暖暖 因為崴崴寶",
		img: "https://placehold.co/367x492/png?text=Nelson"
	},
	{
		name: "yc油成",
		desc: "擁有豐富的數學背景",
		img: "https://placehold.co/367x492/png?text=YC"
	}
];
---

<section class="speaker-section">
	<div class="title">
		<h2>年會</h2>
		<div class="line"></div>
		<h2>邀請講者</h2>
	</div>

	<div class="content-wrapper">
		<div class="speaker-list">
			{
				speakers.map((person, index) => (
					<div class:list={["speaker-item", { active: index === 0 }]} data-img={person.img}>
						<a>{person.name}</a>
						<p class="speakerDesc">{person.desc}</p>
					</div>
				))
			}
		</div>

		<div class="speaker-image">
			<img id="speaker-img" class="desktop-img" src={speakers[0].img} alt="Speaker" />

			<div class="marquee-container">
				<div class="marquee-track">
					{speakers.map(person => <img class="marquee-item" src={person.img} alt={person.name} />)}
					{speakers.map(person => <img class="marquee-item" src={person.img} alt={person.name} />)}
				</div>
			</div>
		</div>
	</div>

	<a href="#" class="cta-btn">查看議程表</a>

	<div class="bg-optimized">
		<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1512 543" preserveAspectRatio="none">
			<path opacity="0.34" d="M1512 0L0 320V543H1512V0Z" fill="#A1A1A1"></path>
			<path opacity="0.34" d="M0 0L1512 320V543H0V0Z" fill="#D9D9D9"></path>
			<path opacity="0.34" d="M0 0L1512 320V543H0V0Z" fill="#CDCDCD"></path>
		</svg>
	</div>
</section>

<style>
	@keyframes scroll {
		0% {
			transform: translateX(0);
		}
		100% {
			transform: translateX(-50%);
		}
	}

	.speaker-section {
		position: relative;
		background-color: #f4f4f4;
		padding: 4rem 2rem;
		display: flex;
		flex-direction: column;
		align-items: center;
		overflow: hidden;
	}

	.title {
		width: 100%;
		max-width: var(--max-width);
		margin-bottom: 3rem;
		color: #a79164;
		display: grid;
		grid-template-columns: max-content 1fr max-content;
		align-items: center;
		gap: 2rem;
	}

	.title h2 {
		font-size: 5rem;
		margin: 0;
		font-weight: 600;
		white-space: nowrap;
	}

	.line {
		height: 0.0625rem;
		background-color: #a79164;
		width: 100%;
		justify-self: center;
	}

	.content-wrapper {
		width: 100%;
		max-width: var(--max-width);
		display: grid;
		grid-template-columns: 4fr 6fr;
		gap: 4rem;
		align-items: center;
	}

	.speaker-list {
		display: flex;
		flex-direction: column;
		align-items: flex-start;
		gap: 3rem;
	}

	.speaker-item {
		font-size: 3rem;
		font-weight: bold;
		color: rgba(169, 124, 33, 0.3);
		cursor: pointer;
		transition: 0.3s;
		display: flex;
		flex-direction: column;
	}

	.speaker-item.active {
		color: #a79164;
		transform: scale(1.1);
		transform-origin: left center;
	}

	.speakerDesc {
		display: none;
	}

	.speaker-image {
		width: 100%;
		display: flex;
		justify-content: center;
		perspective: 1000px;
	}

	.desktop-img {
		display: block;
		max-width: 100%;
		height: auto;
		border-radius: 0.5rem;
		box-shadow: 0 0.625rem 1.25rem rgba(0, 0, 0, 0.1);
		transform-style: preserve-3d;
		transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
	}

	.marquee-container {
		display: none;
	}

	.cta-btn {
		display: inline-block;
		text-decoration: none;
		font-family: sans-serif;
		font-weight: 700;
		font-size: 1.5rem;
		letter-spacing: 0.05em;
		color: #4f4031;
		padding: 0.75rem 3rem;
		margin-top: 5rem;
		border: 0.125rem solid #4f4031;
		border-radius: 624.9375rem;
		background: linear-gradient(180deg, #e6dac0 0%, #c4b188 100%);
		transition:
			transform 0.2s,
			filter 0.2s;
	}

	.cta-btn:hover {
		transform: translateY(-0.125rem);
		filter: brightness(1.05);
	}

	.title,
	.content-wrapper,
	.cta-btn {
		position: relative;
		z-index: 1;
	}

	.bg-optimized {
		position: absolute;
		top: auto;
		bottom: 0;
		left: 0;
		width: 100%;
		height: 60%;
		pointer-events: none;
		z-index: 0;
	}

	.bg-optimized svg {
		width: 100%;
		height: 100%;
		display: block;
	}

	@media (max-width: 900px) {
		.speaker-section {
			padding: 3rem 1.5rem 8rem 1.5rem;
		}

		.title {
			width: 100%;
			margin-bottom: 2rem;
			grid-template-columns: max-content 1fr;
			row-gap: 0.5rem;
			column-gap: 0.9375rem;
			align-items: center;
		}

		.title h2 {
			font-size: 3rem;
			margin: 0;
			line-height: 1;
		}

		.line {
			width: 100%;
			margin: 0;
			align-self: center;
		}

		.title h2:nth-of-type(2) {
			grid-column: 1 / -1;
			margin-left: 2rem;
		}

		.content-wrapper {
			grid-template-columns: 1fr;
			gap: 2.5rem;
		}

		.speaker-list {
			align-items: flex-start;
			width: 100%;
			gap: 1.5rem;
		}

		.speaker-item {
			font-size: 1.5rem;
			align-items: flex-start;
			width: 100%;
			text-align: left;
		}

		.speaker-item.active {
			transform-origin: left center;
		}

		.speakerDesc {
			display: block;
			font-size: 1rem;
			font-weight: normal;
			margin-top: 0.5rem;
			color: #4f4031;
			opacity: 1;
		}

		.speaker-image {
			width: calc(100% + 3rem);
			margin-left: -1.5rem;
			overflow: hidden;
			margin-top: 2rem;
		}

		.desktop-img {
			display: none;
		}

		.marquee-container {
			display: block;
			width: 100%;
		}

		.marquee-track {
			display: flex;
			width: max-content;
			gap: 0.625rem;
			animation: scroll 20s linear infinite;
		}

		.marquee-item {
			height: 15.625rem;
			width: auto;
			border-radius: 0.75rem;
			box-shadow: 0 0.3125rem 0.9375rem rgba(0, 0, 0, 0.1);
			flex-shrink: 0;
		}

		.cta-btn {
			width: auto;
			text-align: center;
			padding: 0.625rem 2rem;
			font-size: 1.2rem;
		}

		.bg-optimized {
			height: 50%;
		}
	}
</style>

<script>
	import { gsap } from "gsap";
	const items = document.querySelectorAll(".speaker-item");
	const imgElement = document.getElementById("speaker-img");
	let currentIndex = 0;

	function updateView(index: number) {
		items.forEach(item => {
			item.classList.remove("active");
		});

		const targetItem = items[index];
		targetItem.classList.add("active");

		const newImgSrc = targetItem.getAttribute("data-img");
		if (imgElement && newImgSrc) {
			(imgElement as HTMLImageElement).src = newImgSrc;
		}

		currentIndex = index;
	}

	items.forEach((item, index) => {
		item.addEventListener("mouseenter", () => {
			updateView(index);
			stopAutoPlay();
		});

		item.addEventListener("mouseleave", () => {
			startAutoPlay();
		});
	});

	let timer: number | null = null;

	function startAutoPlay() {
		if (timer) return;
		timer = window.setInterval(() => {
			const nextIndex = (currentIndex + 1) % items.length;
			updateView(nextIndex);
		}, 2000);
	}

	function stopAutoPlay() {
		if (timer) window.clearInterval(timer);
		timer = null;
	}

	startAutoPlay();

	const speakerImage = document.querySelector(".speaker-image");
	const desktopImg = document.querySelector(".desktop-img");

	speakerImage?.addEventListener("mousemove", e => {
		const { clientX, clientY } = e;
		const { left, top, width, height } = speakerImage.getBoundingClientRect();
		const x = clientX - left;
		const y = clientY - top;
		const rotateX = gsap.utils.mapRange(0, height, -10, 10, y);
		const rotateY = gsap.utils.mapRange(0, width, 10, -10, x);

		gsap.to(desktopImg, {
			rotateX,
			rotateY,
			duration: 0.4,
			ease: "power2.out"
		});
	});

	speakerImage?.addEventListener("mouseleave", () => {
		gsap.to(desktopImg, {
			rotateX: 0,
			rotateY: 0,
			duration: 0.4,
			ease: "power2.out"
		});
	});
</script>
