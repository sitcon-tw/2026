---
import { useTranslations, type Lang } from "@/utils/i18n";

interface Props {
	lang?: Lang;
}

const lang = Astro.props.lang ?? "zh";
const t = useTranslations(lang).sponsor;
const logoSrc = "/2026/img/SITCON-withname.svg";

// 正式資料匯入會改用 json 儲存
const sponsors = {
	main: { name: "SITCON 學生計算機年會", desc: "學生自發組成的研討會，秉持著以學生為主軸的核心精神。", type: t.main },
	cohost: Array.from({ length: 2 }).map((_, i) => ({
		name: `${t.cohost} ${i + 1}`,
		desc: "感謝合辦單位的強力支援！",
		type: t.cohost
	})),
	organizer: { name: "協辦單位 A", desc: "協助場地與設備支援。", type: t.organizer },
	pilot: Array.from({ length: 15 }).map((_, i) => ({
		name: `${t.pilot}贊助 ${i + 1}`,
		desc: `這是${t.pilot}贊助商 ${i + 1} 的詳細介紹文案......`,
		type: t.pilot
	})),
	deep: Array.from({ length: 9 }).map((_, i) => ({
		name: `${t.deep}贊助 ${i + 1}`,
		desc: `這是${t.deep}贊助商 ${i + 1} 的詳細介紹文案......`,
		type: t.deep
	}))
};
---

<section class="sponsor-container">
	<div class="content-wrapper">
		<div class="section-group">
			<div class="top-tier-grid">
				<div class="tier-item">
					<h3 class="tier-title">{t.main}</h3>
					<button class="logo-box sponsor-trigger" data-name={sponsors.main.name} data-desc={sponsors.main.desc} data-type={sponsors.main.type} data-img={logoSrc}>
						<img src={logoSrc} alt={sponsors.main.name} />
					</button>
				</div>

				<div class="tier-item">
					<h3 class="tier-title">{t.cohost}</h3>
					<div class="logo-row-2">
						{
							sponsors.cohost.map(s => (
								<button class="logo-box sponsor-trigger" data-name={s.name} data-desc={s.desc} data-type={s.type} data-img={logoSrc}>
									<img src={logoSrc} alt={s.name} />
								</button>
							))
						}
					</div>
				</div>

				<div class="tier-item">
					<h3 class="tier-title">{t.organizer}</h3>
					<button class="logo-box sponsor-trigger" data-name={sponsors.organizer.name} data-desc={sponsors.organizer.desc} data-type={sponsors.organizer.type} data-img={logoSrc}>
						<img src={logoSrc} alt={sponsors.organizer.name} />
					</button>
				</div>
			</div>
		</div>

		<div class="section-group">
			<h3 class="tier-title text-reveal-title">{t.pilot}</h3>
			<div class="main-grid">
				{
					sponsors.pilot.map(s => (
						<button class="logo-box center-box sponsor-trigger" data-name={s.name} data-desc={s.desc} data-type={s.type} data-img={logoSrc}>
							<img src={logoSrc} alt={s.name} />
						</button>
					))
				}
			</div>
		</div>

		<div class="section-group">
			<h3 class="tier-title text-reveal-title">{t.deep}</h3>
			<div class="main-grid">
				{
					sponsors.deep.map(s => (
						<button class="logo-box center-box sponsor-trigger" data-name={s.name} data-desc={s.desc} data-type={s.type} data-img={logoSrc}>
							<img src={logoSrc} alt={s.name} />
						</button>
					))
				}
				<button class="logo-box center-box person-sponsor sponsor-trigger" data-name={t.personalSponsor} data-desc="感謝所有熱情的個人贊助者！" data-type={t.personalSponsor}>
					<span>{t.personalSponsor}</span>
				</button>
			</div>
		</div>
	</div>
</section>

<!-- Popup -->
<dialog id="sponsor-dialog">
	<div class="dialog-wrapper">
		<button id="close-dialog" aria-label="Close">
			<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
				<line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>
			</svg>
		</button>

		<div class="dialog-content">
			<div class="header">
				<span id="dialog-type" class="badge">{t.sponsorLevel}</span>
			</div>

			<div class="logo-area">
				<img id="dialog-img" src="" alt="Sponsor Logo" />
			</div>

			<div class="text-area">
				<h2 id="dialog-title">{t.sponsorName}</h2>
				<p id="dialog-desc">{t.sponsorDesc}</p>
			</div>

			<div class="action-area">
				<a href="#" target="_blank" class="visit-btn">{t.visitWebsite}</a>
			</div>
		</div>
	</div>
</dialog>

<style>
	.sponsor-container {
		background-color: #f2f2f2;
		padding: 4rem 1rem;
		color: #333;
		font-family: sans-serif;
	}

	.content-wrapper {
		max-width: 75rem;
		margin: 0 auto;
		display: flex;
		flex-direction: column;
		gap: 5rem;
	}

	.tier-title {
		font-size: 1.1rem;
		font-weight: bold;
		margin-bottom: 2rem;
		color: #222;
	}

	.logo-box {
		display: flex;
		align-items: center;
		justify-content: center;
		background: none;
		border: none;
		padding: 0;
		cursor: pointer;
		width: 100%;
		outline: none;
		-webkit-tap-highlight-color: transparent;
	}

	.logo-box img {
		width: 100%;
		max-width: 10rem;
		height: auto;
		opacity: 0.4;
		filter: grayscale(100%);
		transition: all 0.3s ease;
		mix-blend-mode: multiply;
		display: block;
	}

	.logo-box:hover img {
		opacity: 1;
		filter: grayscale(0%);
		transform: scale(1.05);
	}

	.top-tier-grid {
		display: grid;
		grid-template-columns: 1fr;
		gap: 3rem;
	}

	.tier-item {
		display: flex;
		flex-direction: column;
	}

	.center-box {
		justify-content: center;
	}

	.logo-row-2 {
		display: flex;
		justify-content: center;
		gap: 2rem;
	}

	.main-grid {
		display: grid;
		grid-template-columns: repeat(2, 1fr);
		gap: 3rem 2rem;
	}

	.person-sponsor {
		font-size: 1.6rem;
		font-weight: bold;
		color: #aaa;
		transition: all 0.3s ease;
	}

	.person-sponsor:hover {
		color: black;
		animation: neon-rainbow 2s linear infinite;
	}

	dialog {
		position: fixed;
		inset: 0;
		margin: auto;
		border: none;
		background: transparent;
		padding: 0;
		width: 90%;
		max-width: 30rem;
		max-height: 90vh;
		overflow: visible;
		z-index: 1000;
	}

	dialog::backdrop {
		background: rgba(0, 0, 0, 0.6);
		backdrop-filter: blur(0.25rem);
		animation: fade-in 0.3s forwards;
	}

	dialog[open] {
		animation: pop-in 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28) forwards;
	}

	dialog.closing {
		animation: pop-out 0.2s ease-in forwards;
	}

	dialog.closing::backdrop {
		animation: fade-out 0.2s ease-in forwards;
	}

	.dialog-wrapper {
		background: #fff;
		border-radius: 1rem;
		padding: 1.5rem;
		position: relative;
		box-shadow: 0 1.5rem 3rem -0.75rem rgba(0, 0, 0, 0.25);
		display: flex;
		flex-direction: column;
		gap: 2rem;
		text-align: center;
	}

	#close-dialog {
		position: absolute;
		top: 1rem;
		right: 1rem;
		background: #f3f4f6;
		border: none;
		border-radius: 50%;
		width: 2rem;
		height: 2rem;
		display: flex;
		align-items: center;
		justify-content: center;
		cursor: pointer;
		color: #666;
		transition: all 0.2s;
		outline: none;
		-webkit-tap-highlight-color: transparent;
		z-index: 10;
	}

	#close-dialog svg {
		width: 1.5rem;
		height: 1.5rem;
	}

	#close-dialog:hover {
		background: #e5e7eb;
		color: #000;
		transform: rotate(90deg);
	}

	.badge {
		background-color: #e0e7ff;
		color: #4338ca;
		font-size: 0.8rem;
		font-weight: 700;
		padding: 0.25rem 0.75rem;
		border-radius: 6rem;
	}

	.logo-area {
		height: 9rem;
		display: flex;
		align-items: center;
		justify-content: center;
		margin-top: 0.5rem;
	}

	.logo-area img {
		max-height: 100%;
		max-width: 18rem;
		object-fit: contain;
	}

	.text-area {
		display: flex;
		flex-direction: column;
		gap: 0.75rem;
	}

	.text-area h2 {
		margin: 0;
		font-size: 1.4rem;
		color: #1f2937;
		line-height: 1.2;
	}

	.text-area p {
		margin: 0;
		font-size: 1rem;
		color: #6b7280;
		line-height: 1.6;
	}

	.action-area {
		margin-top: 1.5rem;
	}

	.visit-btn {
		display: inline-block;
		width: 100%;
		padding: 0.8rem 0;
		background: #111;
		color: #fff;
		border-radius: 0.5rem;
		text-decoration: none;
		font-weight: 500;
		font-size: 1rem;

		transition:
			transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1),
			background 0.3s ease,
			box-shadow 0.3s ease;

		will-change: transform;
		backface-visibility: hidden;
	}

	.visit-btn:hover {
		background: #000;

		transform: scale(1.05);

		box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
	}

	.visit-btn:active {
		transform: scale(0.98);
		box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
	}

	@keyframes pop-in {
		0% {
			opacity: 0;
			transform: scale(0.9);
		}
		100% {
			opacity: 1;
			transform: scale(1);
		}
	}

	@keyframes pop-out {
		0% {
			opacity: 1;
			transform: scale(1);
		}
		100% {
			opacity: 0;
			transform: scale(0.95);
		}
	}

	@keyframes fade-in {
		0% {
			background: rgba(0, 0, 0, 0);
		}
		100% {
			background: rgba(0, 0, 0, 0.6);
		}
	}

	@keyframes fade-out {
		0% {
			background: rgba(0, 0, 0, 0.6);
		}
		100% {
			background: rgba(0, 0, 0, 0);
		}
	}

	@keyframes neon-rainbow {
		0% {
			text-shadow:
				0 0 0.3rem #fff,
				0 0 0.6rem #fff,
				0 0 1.2rem #ff0000;
		}
		50% {
			text-shadow:
				0 0 0.3rem #fff,
				0 0 0.6rem #fff,
				0 0 1.2rem #00ff00;
		}
		100% {
			text-shadow:
				0 0 0.3rem #fff,
				0 0 0.6rem #fff,
				0 0 1.2rem #ff0000;
		}
	}

	@media (min-width: 48rem) {
		.top-tier-grid {
			display: grid;
			grid-template-columns: repeat(5, 1fr);
			gap: 3rem;
		}

		.tier-item:nth-child(1) {
			grid-column: 1;
		}
		.tier-item:nth-child(2) {
			grid-column: 2 / 4;
		}
		.tier-item:nth-child(3) {
			grid-column: 4;
		}

		.tier-item:nth-child(2) .logo-row-2 {
			display: grid;
			grid-template-columns: repeat(2, 1fr);
			gap: 3rem;
		}

		.main-grid {
			grid-template-columns: repeat(5, 1fr);
			gap: 4rem 3rem;
		}

		.dialog-wrapper {
			padding: 3rem;
		}

		.text-area h2 {
			font-size: 1.8rem;
		}

		.text-area p {
			font-size: 1.1rem;
		}
	}
</style>

<script>
	const dialog = document.getElementById("sponsor-dialog") as HTMLDialogElement | null;
	const closeBtn = document.getElementById("close-dialog");
	const dialogTitle = document.getElementById("dialog-title");
	const dialogDesc = document.getElementById("dialog-desc");
	const dialogType = document.getElementById("dialog-type");
	const dialogImg = document.getElementById("dialog-img") as HTMLImageElement | null;

	const closeDialogAnim = () => {
		if (!dialog) return;
		dialog.classList.add("closing");

		dialog.addEventListener(
			"animationend",
			() => {
				dialog.close();
				dialog.classList.remove("closing");
			},
			{ once: true }
		);
	};

	document.addEventListener("click", e => {
		const trigger = (e.target as Element)?.closest(".sponsor-trigger") as HTMLElement | null;

		if (trigger && dialog) {
			const { name, desc, type, img } = trigger.dataset;

			if (dialogTitle) dialogTitle.textContent = name ?? null;
			if (dialogDesc) dialogDesc.textContent = desc ?? null;
			if (dialogType) dialogType.textContent = type ?? null;
			if (dialogImg && img) dialogImg.src = img;

			dialog.showModal();
		}
	});

	if (closeBtn) {
		closeBtn.addEventListener("click", () => {
			closeDialogAnim();
		});
	}

	if (dialog) {
		dialog.addEventListener("click", e => {
			const rect = dialog.getBoundingClientRect();
			const isInDialog = e.clientX >= rect.left && e.clientX <= rect.right && e.clientY >= rect.top && e.clientY <= rect.bottom;
			if (!isInDialog) closeDialogAnim();
		});
	}
</script>
